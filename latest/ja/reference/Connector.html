<!DOCTYPE html>
<html lang="ja">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="generator" content="Typelevel Laika + Helium Theme" />
  <title>コネクタ</title>
  
  <meta name="author" content="ldbc contributors"/>
  
  <meta name="author" content="Takahiko Tominaga"/>
  
  
  <meta name="description" content="Documentation for ldbc"/>
  
  
  
  <link rel="icon" sizes="32x32" type="image/png" href="https://typelevel.org/img/favicon.png"/>
  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700">
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fira+Mono:500">
  
  <link rel="stylesheet" type="text/css" href="../../helium/site/icofont.min.css" />
    <link rel="stylesheet" type="text/css" href="../../helium/site/laika-helium.css" />
    <link rel="stylesheet" type="text/css" href="../../css/site.css" />
  <script src="../../helium/site/laika-helium.js"></script>
    <script src="../../helium/site/laika-versions.js"></script>
  <script>initVersions("../../../", "/ja/reference/Connector.html", "latest", null);</script>
  
  <script> /* for avoiding page load transitions */ </script>
</head>

<body>

<header id="top-bar" class="light-default dark-default">

  <div class="row">
    <a id="nav-icon">
      <i class="icofont-laika navigationMenu" title="Navigation">&#xefa2;</i>
    </a>
    
    <div class="menu-container version-menu">
      <a class="text-link menu-toggle" href="#">Version 0.3</a>
      <nav class="menu-content">
        <ul class="nav-list">
          <li class="level1 nav-leaf"><a href="../../older-versions.html">Older Versions</a></li>
        </ul>
      </nav>
    </div>
  </div>

  <a class="image-link" href="https://typelevel.org"><img src="https://typelevel.org/img/logo.svg"></a>

  <div class="row links">
    
    <a class="icon-link svg-link" href="https://github.com/takapi327/ldbc"><span class="github" title="Source Code"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
  <g class="svg-shape">
    <path d="M49.995,1c-27.609,-0 -49.995,22.386 -49.995,50.002c-0,22.09 14.325,40.83 34.194,47.444c2.501,0.458 3.413,-1.086 3.413,-2.412c0,-1.185 -0.043,-4.331 -0.067,-8.503c-13.908,3.021 -16.843,-6.704 -16.843,-6.704c-2.274,-5.773 -5.552,-7.311 -5.552,-7.311c-4.54,-3.103 0.344,-3.042 0.344,-3.042c5.018,0.356 7.658,5.154 7.658,5.154c4.46,7.64 11.704,5.433 14.552,4.156c0.454,-3.232 1.744,-5.436 3.174,-6.685c-11.102,-1.262 -22.775,-5.553 -22.775,-24.713c-0,-5.457 1.949,-9.92 5.147,-13.416c-0.516,-1.265 -2.231,-6.348 0.488,-13.233c0,0 4.199,-1.344 13.751,5.126c3.988,-1.108 8.266,-1.663 12.518,-1.682c4.245,0.019 8.523,0.574 12.517,1.682c9.546,-6.47 13.736,-5.126 13.736,-5.126c2.728,6.885 1.013,11.968 0.497,13.233c3.204,3.496 5.141,7.959 5.141,13.416c0,19.209 -11.691,23.436 -22.83,24.673c1.795,1.544 3.394,4.595 3.394,9.26c0,6.682 -0.061,12.076 -0.061,13.715c0,1.338 0.899,2.894 3.438,2.406c19.853,-6.627 34.166,-25.354 34.166,-47.438c-0,-27.616 -22.389,-50.002 -50.005,-50.002"/>
  </g>
</svg></span></a>
    
    <a class="icon-link glyph-link" href="https://discord.gg/XF3CXcMzqD"><i class="icofont-laika chat" title="Chat">&#xeed5;</i></a>
    
    <a class="icon-link svg-link" href="https://fosstodon.org/@typelevel"><span class="mastodon" title="Mastodon"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <g class="svg-shape">
    <path d="M11.19 12.195c2.016-.24 3.77-1.475 3.99-2.603.348-1.778.32-4.339.32-4.339 0-3.47-2.286-4.488-2.286-4.488C12.062.238 10.083.017 8.027 0h-.05C5.92.017 3.942.238 2.79.765c0 0-2.285 1.017-2.285 4.488l-.002.662c-.004.64-.007 1.35.011 2.091.083 3.394.626 6.74 3.78 7.57 1.454.383 2.703.463 3.709.408 1.823-.1 2.847-.647 2.847-.647l-.06-1.317s-1.303.41-2.767.36c-1.45-.05-2.98-.156-3.215-1.928a3.614 3.614 0 0 1-.033-.496s1.424.346 3.228.428c1.103.05 2.137-.064 3.188-.189zm1.613-2.47H11.13v-4.08c0-.859-.364-1.295-1.091-1.295-.804 0-1.207.517-1.207 1.541v2.233H7.168V5.89c0-1.024-.403-1.541-1.207-1.541-.727 0-1.091.436-1.091 1.296v4.079H3.197V5.522c0-.859.22-1.541.66-2.046.456-.505 1.052-.764 1.793-.764.856 0 1.504.328 1.933.983L8 4.39l.417-.695c.429-.655 1.077-.983 1.934-.983.74 0 1.336.259 1.791.764.442.505.661 1.187.661 2.046v4.203z"/>
  </g>
</svg></span></a>
    
    <a class="icon-link svg-link" href="https://javadoc.io/doc/io.github.takapi327/ldbc-dsl_3/latest/index.html"><span class="api" title="API"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
  <g class="svg-shape">
    <path d="M75,47.5c13.246,0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm-50,-0c13.246,-0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,-0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm2.705,16.735l7.239,0l0.622,-4.904l-21.833,0l-0,4.904l7.589,0l0,22.067l6.383,0l-0,-22.067Zm58.076,7.265c-0,-8.757 -3.698,-14.166 -10.781,-14.166c-7.083,-0 -10.781,5.604 -10.781,14.166c0,8.757 3.698,14.166 10.781,14.166c7.083,0 10.781,-5.604 10.781,-14.166Zm-6.539,0c0,6.538 -1.128,9.496 -4.242,9.496c-2.997,0 -4.242,-2.88 -4.242,-9.496c-0,-6.616 1.206,-9.496 4.242,-9.496c3.036,-0 4.242,2.88 4.242,9.496Zm-29.242,-67c13.246,0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm0.512,9.834c-7.122,-0 -12.609,5.098 -12.609,14.127c-0,9.263 5.215,14.205 12.532,14.205c4.164,0 7.083,-1.634 9.068,-3.658l-2.88,-3.697c-1.518,1.206 -3.153,2.413 -5.838,2.413c-3.697,-0 -6.266,-2.763 -6.266,-9.263c-0,-6.616 2.724,-9.379 6.149,-9.379c2.102,-0 3.892,0.778 5.371,1.984l3.113,-3.775c-2.257,-1.868 -4.748,-2.957 -8.64,-2.957Z"/>
  </g>
</svg></span></a>
    
  </div>  

</header>

<nav id="sidebar">

  <div class="row">
    
    <a class="icon-link svg-link" href="https://github.com/takapi327/ldbc"><span class="github" title="Source Code"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
  <g class="svg-shape">
    <path d="M49.995,1c-27.609,-0 -49.995,22.386 -49.995,50.002c-0,22.09 14.325,40.83 34.194,47.444c2.501,0.458 3.413,-1.086 3.413,-2.412c0,-1.185 -0.043,-4.331 -0.067,-8.503c-13.908,3.021 -16.843,-6.704 -16.843,-6.704c-2.274,-5.773 -5.552,-7.311 -5.552,-7.311c-4.54,-3.103 0.344,-3.042 0.344,-3.042c5.018,0.356 7.658,5.154 7.658,5.154c4.46,7.64 11.704,5.433 14.552,4.156c0.454,-3.232 1.744,-5.436 3.174,-6.685c-11.102,-1.262 -22.775,-5.553 -22.775,-24.713c-0,-5.457 1.949,-9.92 5.147,-13.416c-0.516,-1.265 -2.231,-6.348 0.488,-13.233c0,0 4.199,-1.344 13.751,5.126c3.988,-1.108 8.266,-1.663 12.518,-1.682c4.245,0.019 8.523,0.574 12.517,1.682c9.546,-6.47 13.736,-5.126 13.736,-5.126c2.728,6.885 1.013,11.968 0.497,13.233c3.204,3.496 5.141,7.959 5.141,13.416c0,19.209 -11.691,23.436 -22.83,24.673c1.795,1.544 3.394,4.595 3.394,9.26c0,6.682 -0.061,12.076 -0.061,13.715c0,1.338 0.899,2.894 3.438,2.406c19.853,-6.627 34.166,-25.354 34.166,-47.438c-0,-27.616 -22.389,-50.002 -50.005,-50.002"/>
  </g>
</svg></span></a>
    
    <a class="icon-link glyph-link" href="https://discord.gg/XF3CXcMzqD"><i class="icofont-laika chat" title="Chat">&#xeed5;</i></a>
    
    <a class="icon-link svg-link" href="https://fosstodon.org/@typelevel"><span class="mastodon" title="Mastodon"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <g class="svg-shape">
    <path d="M11.19 12.195c2.016-.24 3.77-1.475 3.99-2.603.348-1.778.32-4.339.32-4.339 0-3.47-2.286-4.488-2.286-4.488C12.062.238 10.083.017 8.027 0h-.05C5.92.017 3.942.238 2.79.765c0 0-2.285 1.017-2.285 4.488l-.002.662c-.004.64-.007 1.35.011 2.091.083 3.394.626 6.74 3.78 7.57 1.454.383 2.703.463 3.709.408 1.823-.1 2.847-.647 2.847-.647l-.06-1.317s-1.303.41-2.767.36c-1.45-.05-2.98-.156-3.215-1.928a3.614 3.614 0 0 1-.033-.496s1.424.346 3.228.428c1.103.05 2.137-.064 3.188-.189zm1.613-2.47H11.13v-4.08c0-.859-.364-1.295-1.091-1.295-.804 0-1.207.517-1.207 1.541v2.233H7.168V5.89c0-1.024-.403-1.541-1.207-1.541-.727 0-1.091.436-1.091 1.296v4.079H3.197V5.522c0-.859.22-1.541.66-2.046.456-.505 1.052-.764 1.793-.764.856 0 1.504.328 1.933.983L8 4.39l.417-.695c.429-.655 1.077-.983 1.934-.983.74 0 1.336.259 1.791.764.442.505.661 1.187.661 2.046v4.203z"/>
  </g>
</svg></span></a>
    
    <a class="icon-link svg-link" href="https://javadoc.io/doc/io.github.takapi327/ldbc-dsl_3/latest/index.html"><span class="api" title="API"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
  <g class="svg-shape">
    <path d="M75,47.5c13.246,0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm-50,-0c13.246,-0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,-0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm2.705,16.735l7.239,0l0.622,-4.904l-21.833,0l-0,4.904l7.589,0l0,22.067l6.383,0l-0,-22.067Zm58.076,7.265c-0,-8.757 -3.698,-14.166 -10.781,-14.166c-7.083,-0 -10.781,5.604 -10.781,14.166c0,8.757 3.698,14.166 10.781,14.166c7.083,0 10.781,-5.604 10.781,-14.166Zm-6.539,0c0,6.538 -1.128,9.496 -4.242,9.496c-2.997,0 -4.242,-2.88 -4.242,-9.496c-0,-6.616 1.206,-9.496 4.242,-9.496c3.036,-0 4.242,2.88 4.242,9.496Zm-29.242,-67c13.246,0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm0.512,9.834c-7.122,-0 -12.609,5.098 -12.609,14.127c-0,9.263 5.215,14.205 12.532,14.205c4.164,0 7.083,-1.634 9.068,-3.658l-2.88,-3.697c-1.518,1.206 -3.153,2.413 -5.838,2.413c-3.697,-0 -6.266,-2.763 -6.266,-9.263c-0,-6.616 2.724,-9.379 6.149,-9.379c2.102,-0 3.892,0.778 5.371,1.984l3.113,-3.775c-2.257,-1.868 -4.748,-2.957 -8.64,-2.957Z"/>
  </g>
</svg></span></a>
    
  </div>

  
  <ul class="nav-list">
    <li class="level1 nav-leaf"><a href="../">ldbc</a></li>
    <li class="level1 nav-leaf"><a href="../migration-notes.html">Migration Notes</a></li>
    <li class="level1 nav-header">Tutorial</li>
    <li class="level2 nav-leaf"><a href="../tutorial/">はじめに</a></li>
    <li class="level2 nav-leaf"><a href="../tutorial/Setup.html">セットアップ</a></li>
    <li class="level2 nav-leaf"><a href="../tutorial/Connection.html">コネクション</a></li>
    <li class="level2 nav-leaf"><a href="../tutorial/Simple-Program.html">シンプルプログラム</a></li>
    <li class="level2 nav-leaf"><a href="../tutorial/Database-Operations.html">データベース操作</a></li>
    <li class="level2 nav-leaf"><a href="../tutorial/Parameterized-Queries.html">パラメータ</a></li>
    <li class="level2 nav-leaf"><a href="../tutorial/Selecting-Data.html">データ選択</a></li>
    <li class="level2 nav-leaf"><a href="../tutorial/Updating-Data.html">データ更新</a></li>
    <li class="level2 nav-leaf"><a href="../tutorial/Error-Handling.html">エラーハンドリング</a></li>
    <li class="level2 nav-leaf"><a href="../tutorial/Logging.html">ロギング</a></li>
    <li class="level2 nav-leaf"><a href="../tutorial/Custom-Data-Type.html">カスタム データ型</a></li>
    <li class="level2 nav-leaf"><a href="../tutorial/Query-Builder.html">クエリビルダー</a></li>
    <li class="level2 nav-leaf"><a href="../tutorial/Schema.html">スキーマ</a></li>
    <li class="level2 nav-leaf"><a href="../tutorial/Schema-Code-Generation.html">スキーマコード生成</a></li>
    <li class="level1 nav-header">Reference</li>
    <li class="level2 nav-leaf"><a href="index.html">はじめに</a></li>
    <li class="level2 active nav-leaf"><a href="#">コネクタ</a></li>
  </ul>
  

</nav>

<div id="container">

  
<nav id="page-nav">
  <p class="header"><a href="#">コネクタ</a></p>

  <ul class="nav-list">
    <li class="level1 nav-node"><a href="#接続">接続</a></li>
    <li class="level2 nav-leaf"><a href="#認証">認証</a></li>
    <li class="level1 nav-node"><a href="#実行">実行</a></li>
    <li class="level2 nav-leaf"><a href="#statement">Statement</a></li>
    <li class="level2 nav-leaf"><a href="#client-server-preparedstatement">Client/Server PreparedStatement</a></li>
    <li class="level2 nav-leaf"><a href="#resultset">ResultSet</a></li>
    <li class="level1 nav-node"><a href="#トランザクション">トランザクション</a></li>
    <li class="level2 nav-leaf"><a href="#トランザクション分離レベル">トランザクション分離レベル</a></li>
    <li class="level2 nav-leaf"><a href="#セーブポイント">セーブポイント</a></li>
    <li class="level1 nav-node"><a href="#ユーティリティコマンド">ユーティリティコマンド</a></li>
    <li class="level2 nav-leaf"><a href="#com-quit">COM QUIT</a></li>
    <li class="level2 nav-leaf"><a href="#com-init-db">COM INIT DB</a></li>
    <li class="level2 nav-leaf"><a href="#com-statistics">COM STATISTICS</a></li>
    <li class="level2 nav-leaf"><a href="#com-ping">COM PING</a></li>
    <li class="level2 nav-leaf"><a href="#com-change-user">COM CHANGE USER</a></li>
    <li class="level2 nav-leaf"><a href="#com-reset-connection">COM RESET CONNECTION</a></li>
    <li class="level2 nav-leaf"><a href="#com-set-option">COM SET OPTION</a></li>
    <li class="level1 nav-node"><a href="#バッチコマンド">バッチコマンド</a></li>
    <li class="level2 nav-leaf"><a href="#statementとpreparedstatementの違い">StatementとPreparedStatementの違い</a></li>
    <li class="level1 nav-leaf"><a href="#ストアドプロシージャの実行">ストアドプロシージャの実行</a></li>
    <li class="level1 nav-leaf"><a href="#未対応機能">未対応機能</a></li>
  </ul>

  <p class="footer"></p>
</nav>


  <main class="content">

    <h1 id="コネクタ" class="title">コネクタ</h1>
    <p>この章では、ldbc独自のMySQLコネクタを使用したデータベース接続について説明します。</p>
    <p>ScalaでMySQLデータベースへの接続を行うためにはJDBCを使用する必要があります。JDBCはJavaの標準APIであり、Scalaでも使用することができます。
    JDBCはJavaで実装が行われているためScalaで使用する場合でもJVM環境でのみ動作することができます。</p>
    <p>昨今のScalaを取り巻く環境はJSやNativeなどの環境でも動作できるようプラグインの開発が盛んに行われています。
    ScalaはJavaの資産を使用できるJVMのみで動作する言語から、マルチプラットフォーム環境でも動作できるよう進化を続けています。</p>
    <p>しかし、JDBCはJavaの標準APIでありScalaのマルチプラットフォーム環境での動作をサポートしていません。</p>
    <p>そのため、ScalaでアプリケーションをJS, Nativeなどで動作できるように作成を行ったとしてもJDBCを使用できないため、MySQLなどのデータベースへ接続を行うことができません。</p>
    <p>Typelevel Projectには<a href="https://github.com/typelevel/skunk">Skunk</a>と呼ばれる<a href="https://www.postgresql.org/">PostgreSQL</a>用のScalaライブラリが存在します。
    このプロジェクトはJDBCを使用しておらず、純粋なScalaのみでPostgreSQLへの接続を実現しています。そのため、Skunkを使用すればJVM, JS, Native環境を問わずPostgreSQLへの接続を行うことができます。</p>
    <p>ldbc コネクタはこのSkunkに影響を受けてJVM, JS, Native環境を問わずMySQLへの接続を行えるようにするために開発が行われてるプロジェクトです。</p>
    <p>※ このコネクタは現在実験的な機能となります。そのため本番環境での使用しないでください。</p>
    <p>ldbcコネクタは一番低レイヤーのAPIとなります。
    今後このコネクタを使用してより高レイヤーのAPIを提供する予定です。また既存の高レイヤーのAPIとの互換性を持たせることも予定しています。</p>
    <p>使用するにはプロジェクトに以下の依存関係を設定する必要があります。</p>
    <p><strong>JVM</strong></p>
    <pre class="keep-together pdf epub"><code class="nohighlight"><span class="identifier">libraryDependencies</span><span> += </span><span class="string-literal">&quot;io.github.takapi327&quot;</span><span> %% </span><span class="string-literal">&quot;ldbc-connector&quot;</span><span> % </span><span class="string-literal">&quot;0.3.0-beta8&quot;</span></code></pre>
    <p><strong>JS/Native</strong></p>
    <pre class="keep-together pdf epub"><code class="nohighlight"><span class="identifier">libraryDependencies</span><span> += </span><span class="string-literal">&quot;io.github.takapi327&quot;</span><span> %%% </span><span class="string-literal">&quot;ldbc-connector&quot;</span><span> % </span><span class="string-literal">&quot;0.3.0-beta8&quot;</span></code></pre>
    <p><strong>サポートバージョン</strong></p>
    <p>現在のバージョンは以下のバージョンのMySQLをサポートしています。</p>
    <ul>
      <li>MySQL 5.7.x</li>
      <li>MySQL 8.x</li>
    </ul>
    <p>メインサポートはMySQL 8.xです。MySQL 5.7.xはサブサポートとなります。そのためMySQL 5.7.xでの動作には注意が必要です。
    将来的にはMySQL 5.7.xのサポートは終了する予定です。</p>
    
    <h2 id="接続" class="section"><a class="anchor-link left" href="#接続"><i class="icofont-laika link">&#xef71;</i></a>接続</h2>
    <p>ldbcコネクタを使用してMySQLへの接続を行うためには、<code>Connection</code>を使用します。</p>
    <p>また、<code>Connection</code>はオブザーバビリティを意識した開発を行えるように<code>Otel4s</code>を使用してテレメトリデータを収集できるようにしています。
    そのため、<code>Connection</code>を使用する際には<code>Otel4s</code>の<code>Tracer</code>を設定する必要があります。</p>
    <p>開発時やトレースを使用したテレメトリデータが不要な場合は<code>Tracer.noop</code>を使用することを推奨します。</p>
    <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">cats</span><span>.</span><span class="identifier">effect</span><span>.</span><span class="type-name">IO</span><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">org</span><span>.</span><span class="identifier">typelevel</span><span>.</span><span class="identifier">otel4s</span><span>.</span><span class="identifier">trace</span><span>.</span><span class="type-name">Tracer</span><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">ldbc</span><span>.</span><span class="identifier">connector</span><span>.</span><span class="type-name">Connection</span><span>

</span><span class="keyword">given</span><span> </span><span class="type-name">Tracer</span><span>[</span><span class="type-name">IO</span><span>] = </span><span class="type-name">Tracer</span><span>.</span><span class="identifier">noop</span><span>[</span><span class="type-name">IO</span><span>]

</span><span class="keyword">val</span><span> </span><span class="identifier">connection</span><span> = </span><span class="type-name">Connection</span><span>[</span><span class="type-name">IO</span><span>](
  </span><span class="identifier">host</span><span> = </span><span class="string-literal">&quot;127.0.0.1&quot;</span><span>,
  </span><span class="identifier">port</span><span> = </span><span class="number-literal">3306</span><span>,
  </span><span class="identifier">user</span><span> = </span><span class="string-literal">&quot;root&quot;</span><span>,
)</span></code></pre>
    <p>以下は<code>Connection</code>構築時に設定できるプロパティの一覧です。</p>
    <table>
      <thead>
        <tr>
          <th>プロパティ</th>
          <th>型</th>
          <th>用途</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><code>host</code></td>
          <td><code>String</code></td>
          <td><code>MySQLサーバーのホストを指定します</code></td>
        </tr>
        <tr>
          <td><code>port</code></td>
          <td><code>Int</code></td>
          <td><code>MySQLサーバーのポート番号を指定します</code></td>
        </tr>
        <tr>
          <td><code>user</code></td>
          <td><code>String</code></td>
          <td><code>MySQLサーバーへログインを行うユーザー名を指定します</code></td>
        </tr>
        <tr>
          <td><code>password</code></td>
          <td><code>Option[String]</code></td>
          <td><code>MySQLサーバーへログインを行うユーザーのパスワードを指定します</code></td>
        </tr>
        <tr>
          <td><code>database</code></td>
          <td><code>Option[String]</code></td>
          <td><code>MySQLサーバーへ接続後に使用するデータベース名を指定します</code></td>
        </tr>
        <tr>
          <td><code>debug</code></td>
          <td><code>Boolean</code></td>
          <td><code>処理のログを出力します。デフォルトはfalseです</code></td>
        </tr>
        <tr>
          <td><code>ssl</code></td>
          <td><code>SSL</code></td>
          <td><code>MySQLサーバーとの通知んでSSL/TLSを使用するかを指定します。デフォルトはSSL.Noneです</code></td>
        </tr>
        <tr>
          <td><code>socketOptions</code></td>
          <td><code>List[SocketOption]</code></td>
          <td><code>TCP/UDP ソケットのソケットオプションを指定します。</code></td>
        </tr>
        <tr>
          <td><code>readTimeout</code></td>
          <td><code>Duration</code></td>
          <td><code>MySQLサーバーへの接続を試みるまでのタイムアウトを指定します。デフォルトはDuration.Infです。</code></td>
        </tr>
        <tr>
          <td><code>allowPublicKeyRetrieval</code></td>
          <td><code>Boolean</code></td>
          <td><code>MySQLサーバーとの認証時にRSA公開鍵を使用するかを指定します。デフォルトはfalseです。</code></td>
        </tr>
      </tbody>
    </table>
    <p><code>Connection</code>は<code>Resource</code>を使用してリソース管理を行います。そのためコネクション情報を使用する場合は<code>use</code>メソッドを使用してリソースの管理を行います。</p>
    <pre class="keep-together pdf epub"><code class="nohighlight"><span class="identifier">connection</span><span>.</span><span class="identifier">use</span><span> { </span><span class="identifier">conn</span><span> =&gt;
  </span><span class="comment">// コードを記述
</span><span>}</span></code></pre>
    
    <h3 id="認証" class="section"><a class="anchor-link left" href="#認証"><i class="icofont-laika link">&#xef71;</i></a>認証</h3>
    <p>MySQLでの認証は、クライアントがMySQLサーバーへ接続するときにLoginRequestというフェーズでユーザ情報を送信します。そして、サーバー側では送られたユーザが<code>mysql.user</code>テーブルに存在するか検索を行い、どの認証プラグインを使用するかを決定します。認証プラグインが決定した後にサーバーはそのプラグインを呼び出してユーザー認証を開始し、その結果をクライアント側に送信します。このようにMySQLでは認証がプラガブル（様々なタイプのプラグインを付け外しできる）になっています。</p>
    <p>MySQLでサポートされている認証プラグインは<a href="https://dev.mysql.com/doc/refman/8.0/ja/authentication-plugins.html">公式ページ</a>に記載されています。</p>
    <p>ldbcは現時点で以下の認証プラグインをサポートしています。</p>
    <ul>
      <li>ネイティブプラガブル認証</li>
      <li>SHA-256 プラガブル認証</li>
      <li>SHA-2 プラガブル認証のキャッシュ</li>
    </ul>
    <p>※ ネイティブプラガブル認証とSHA-256 プラガブル認証はMySQL 8.xから非推奨となったプラグインです。特段理由がない場合はSHA-2 プラガブル認証のキャッシュを使用することを推奨します。</p>
    <p>ldbcのアプリケーションコード上で認証プラグインを意識する必要はありません。ユーザーはMySQLのデータベース上で使用したい認証プラグインで作成されたユーザーを作成し、ldbcのアプリケーションコード上ではそのユーザーを使用してMySQLへの接続を試みるだけで問題ありません。
    ldbcが内部で認証プラグインを判断し、適切な認証プラグインを使用してMySQLへの接続を行います。</p>
    
    <h2 id="実行" class="section"><a class="anchor-link left" href="#実行"><i class="icofont-laika link">&#xef71;</i></a>実行</h2>
    <p>以降の処理では以下テーブルを使用しているものとします。</p>
    <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">CREATE</span><span> </span><span class="keyword">TABLE</span><span> </span><span class="identifier">users</span><span> (
  </span><span class="identifier">id</span><span> </span><span class="type-name">BIGINT</span><span> </span><span class="identifier">AUTO_INCREMENT</span><span> </span><span class="keyword">PRIMARY</span><span> </span><span class="keyword">KEY</span><span>,
  </span><span class="identifier">name</span><span> </span><span class="type-name">VARCHAR</span><span>(</span><span class="number-literal">255</span><span>) </span><span class="keyword">NOT</span><span> </span><span class="literal-value">NULL</span><span>,
  </span><span class="identifier">age</span><span> </span><span class="type-name">INT</span><span> </span><span class="literal-value">NULL</span><span>
);</span></code></pre>
    
    <h3 id="statement" class="section"><a class="anchor-link left" href="#statement"><i class="icofont-laika link">&#xef71;</i></a>Statement</h3>
    <p><code>Statement</code>は動的なパラメーターを使用しないSQLを実行するためのAPIです。</p>
    <p>※ <code>Statement</code>は動的なパラメーターを使用しないため、使い方によってはSQLインジェクションのリスクがあります。そのため、動的なパラメーターを使用する場合は<code>PreparedStatement</code>を使用することを推奨します。</p>
    <p><code>Connection</code>の<code>createStatement</code>メソッドを使用して<code>Statement</code>を構築します。</p>
    
    <h4 id="読み取りクエリ-1" class="section"><a class="anchor-link left" href="#読み取りクエリ-1"><i class="icofont-laika link">&#xef71;</i></a>読み取りクエリ</h4>
    <p>読み取り専用のSQLを実行する場合は<code>executeQuery</code>メソッドを使用します。</p>
    <p>クエリを実行した結果MySQLサーバーから返される値は<code>ResultSet</code>に格納されて戻り値として返却されます。</p>
    <pre class="keep-together pdf epub"><code class="nohighlight"><span class="identifier">connection</span><span>.</span><span class="identifier">use</span><span> { </span><span class="identifier">conn</span><span> =&gt;
  </span><span class="keyword">for</span><span>
    </span><span class="identifier">statement</span><span> &lt;- </span><span class="identifier">conn</span><span>.</span><span class="identifier">createStatement</span><span>()
    </span><span class="identifier">result</span><span> &lt;- </span><span class="identifier">statement</span><span>.</span><span class="identifier">executeQuery</span><span>(</span><span class="string-literal">&quot;SELECT * FROM users&quot;</span><span>)
  </span><span class="keyword">yield</span><span>
    </span><span class="comment">// ResultSetを使用した処理
</span><span>}</span></code></pre>
    
    <h4 id="書き込みクエリ-1" class="section"><a class="anchor-link left" href="#書き込みクエリ-1"><i class="icofont-laika link">&#xef71;</i></a>書き込みクエリ</h4>
    <p>書き込みを行うSQLを実行する場合は<code>executeUpdate</code>メソッドを使用します。</p>
    <p>クエリを実行した結果MySQLサーバーから返される値は影響を受けた行数が戻り値として返却されます。</p>
    <pre class="keep-together pdf epub"><code class="nohighlight"><span class="identifier">connection</span><span>.</span><span class="identifier">use</span><span> { </span><span class="identifier">conn</span><span> =&gt;
  </span><span class="keyword">for</span><span>
    </span><span class="identifier">statement</span><span> &lt;- </span><span class="identifier">conn</span><span>.</span><span class="identifier">createStatement</span><span>()
    </span><span class="identifier">result</span><span> &lt;- </span><span class="identifier">statement</span><span>.</span><span class="identifier">executeUpdate</span><span>(</span><span class="string-literal">&quot;INSERT INTO users (name, age) VALUES (&#39;Alice&#39;, 20)&quot;</span><span>)
  </span><span class="keyword">yield</span><span>
}</span></code></pre>
    
    <h4 id="auto_incrementの値を取得-1" class="section"><a class="anchor-link left" href="#auto_incrementの値を取得-1"><i class="icofont-laika link">&#xef71;</i></a>AUTO_INCREMENTの値を取得</h4>
    <p><code>Statement</code>を使用してクエリ実行後にAUTO_INCREMENTの値を取得する場合は<code>getGeneratedKeys</code>メソッドを使用します。</p>
    <p>クエリを実行した結果MySQLサーバーから返される値はAUTO_INCREMENTに生成された値が戻り値として返却されます。</p>
    <pre class="keep-together pdf epub"><code class="nohighlight"><span class="identifier">connection</span><span>.</span><span class="identifier">use</span><span> { </span><span class="identifier">conn</span><span> =&gt;
  </span><span class="keyword">for</span><span>
    </span><span class="identifier">statement</span><span> &lt;- </span><span class="identifier">conn</span><span>.</span><span class="identifier">createStatement</span><span>()
    </span><span class="identifier">_</span><span> &lt;- </span><span class="identifier">statement</span><span>.</span><span class="identifier">executeUpdate</span><span>(</span><span class="string-literal">&quot;INSERT INTO users (name, age) VALUES (&#39;Alice&#39;, 20)&quot;</span><span>, </span><span class="type-name">Statement</span><span>.</span><span class="type-name">RETURN_GENERATED_KEYS</span><span>)
    </span><span class="identifier">gereatedKeys</span><span> &lt;- </span><span class="identifier">statement</span><span>.</span><span class="identifier">getGeneratedKeys</span><span>()
  </span><span class="keyword">yield</span><span>
}</span></code></pre>
    
    <h3 id="client-server-preparedstatement" class="section"><a class="anchor-link left" href="#client-server-preparedstatement"><i class="icofont-laika link">&#xef71;</i></a>Client/Server PreparedStatement</h3>
    <p>ldbcでは<code>PreparedStatement</code>を<code>Client PreparedStatement</code>と<code>Server PreparedStatement</code>に分けて提供しています。</p>
    <p><code>Client PreparedStatement</code>は動的なパラメーターを使用してアプリケーション上でSQLの構築を行い、MySQLサーバーに送信を行うためのAPIです。
    そのためMySQLサーバーへのクエリ送信方法は<code>Statement</code>と同じになります。</p>
    <p>このAPIはJDBCの<code>PreparedStatement</code>に相当します。</p>
    <p>より安全なMySQLサーバー内でクエリを構築するための<code>PreparedStatement</code>は<code>Server PreparedStatement</code>で提供されますので、そちらを使用してください。</p>
    <p><code>Server PreparedStatement</code>は実行を行うクエリをMySQLサーバー内で事前に準備を行い、アプリケーション上でパラメーターを設定して実行を行うためのAPIです。</p>
    <p><code>Server PreparedStatement</code>では実行するクエリの送信とパラメーターの送信が分けて行われるため、クエリの再利用が可能となります。</p>
    <p><code>Server PreparedStatement</code>を使用する場合事前にクエリをMySQLサーバーで準備します。格納するためにMySQLサーバーはメモリを使用しますが、クエリの再利用が可能となるため、パフォーマンスの向上が期待できます。</p>
    <p>しかし、事前準備されたクエリは解放されるまでメモリを使用し続けるため、メモリリークのリスクがあります。</p>
    <p><code>Server PreparedStatement</code>を使用する場合は<code>close</code>メソッドを使用して適切にクエリの解放を行う必要があります。</p>
    
    <h4 id="client-preparedstatement" class="section"><a class="anchor-link left" href="#client-preparedstatement"><i class="icofont-laika link">&#xef71;</i></a>Client PreparedStatement</h4>
    <p><code>Connection</code>の<code>clientPreparedStatement</code>メソッドを使用して<code>Client PreparedStatement</code>を構築します。</p>
    <pre class="keep-together pdf epub"><code class="nohighlight"><span class="identifier">connection</span><span>.</span><span class="identifier">use</span><span> { </span><span class="identifier">conn</span><span> =&gt;
  </span><span class="keyword">for</span><span> 
    </span><span class="identifier">statement</span><span> &lt;- </span><span class="identifier">conn</span><span>.</span><span class="identifier">clientPreparedStatement</span><span>(</span><span class="string-literal">&quot;SELECT * FROM users WHERE id = ?&quot;</span><span>)
    ...
  </span><span class="keyword">yield</span><span> ...
}</span></code></pre>
    
    <h4 id="server-preparedstatement" class="section"><a class="anchor-link left" href="#server-preparedstatement"><i class="icofont-laika link">&#xef71;</i></a>Server PreparedStatement</h4>
    <p><code>Connection</code>の<code>serverPreparedStatement</code>メソッドを使用して<code>Server PreparedStatement</code>を構築します。</p>
    <pre class="keep-together pdf epub"><code class="nohighlight"><span class="identifier">connection</span><span>.</span><span class="identifier">use</span><span> { </span><span class="identifier">conn</span><span> =&gt;
  </span><span class="keyword">for</span><span> 
    </span><span class="identifier">statement</span><span> &lt;- </span><span class="identifier">conn</span><span>.</span><span class="identifier">serverPreparedStatement</span><span>(</span><span class="string-literal">&quot;SELECT * FROM users WHERE id = ?&quot;</span><span>)
    ...
  </span><span class="keyword">yield</span><span> ...
}</span></code></pre>
    
    <h4 id="読み取りクエリ-2" class="section"><a class="anchor-link left" href="#読み取りクエリ-2"><i class="icofont-laika link">&#xef71;</i></a>読み取りクエリ</h4>
    <p>読み取り専用のSQLを実行する場合は<code>executeQuery</code>メソッドを使用します。</p>
    <p>クエリを実行した結果MySQLサーバーから返される値は<code>ResultSet</code>に格納されて戻り値として返却されます。</p>
    <pre class="keep-together pdf epub"><code class="nohighlight"><span class="identifier">connection</span><span>.</span><span class="identifier">use</span><span> { </span><span class="identifier">conn</span><span> =&gt;
  </span><span class="keyword">for</span><span> 
    </span><span class="identifier">statement</span><span> &lt;- </span><span class="identifier">conn</span><span>.</span><span class="identifier">clientPreparedStatement</span><span>(</span><span class="string-literal">&quot;SELECT * FROM users WHERE id = ?&quot;</span><span>) </span><span class="comment">// or conn.serverPreparedStatement(&quot;SELECT * FROM users WHERE id = ?&quot;)
</span><span>    </span><span class="identifier">_</span><span> &lt;- </span><span class="identifier">statement</span><span>.</span><span class="identifier">setLong</span><span>(</span><span class="number-literal">1</span><span>, </span><span class="number-literal">1</span><span>)
    </span><span class="identifier">result</span><span> &lt;- </span><span class="identifier">statement</span><span>.</span><span class="identifier">executeQuery</span><span>()
  </span><span class="keyword">yield</span><span>
    </span><span class="comment">// ResultSetを使用した処理
</span><span>}</span></code></pre>
    <p>動的なパラメーターを使用する場合は<code>setXXX</code>メソッドを使用してパラメーターを設定します。
    <code>setXXX</code>メソッドは<code>Option</code>型を使用することもできます。<code>None</code>が渡された場合パラメーターにはNULLがセットされます。</p>
    <p><code>setXXX</code>メソッドはパラメーターのインデックスとパラメーターの値を指定します。</p>
    <pre class="keep-together pdf epub"><code class="nohighlight"><span class="identifier">statement</span><span>.</span><span class="identifier">setLong</span><span>(</span><span class="number-literal">1</span><span>, </span><span class="number-literal">1</span><span>)</span></code></pre>
    <p>現在のバージョンでは以下のメソッドがサポートされています。</p>
    <table>
      <thead>
        <tr>
          <th>メソッド</th>
          <th>型</th>
          <th>備考</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><code>setNull</code></td>
          <td></td>
          <td>パラメーターにNULLをセットします</td>
        </tr>
        <tr>
          <td><code>setBoolean</code></td>
          <td><code>Boolean/Option[Boolean]</code></td>
          <td></td>
        </tr>
        <tr>
          <td><code>setByte</code></td>
          <td><code>Byte/Option[Byte]</code></td>
          <td></td>
        </tr>
        <tr>
          <td><code>setShort</code></td>
          <td><code>Short/Option[Short]</code></td>
          <td></td>
        </tr>
        <tr>
          <td><code>setInt</code></td>
          <td><code>Int/Option[Int]</code></td>
          <td></td>
        </tr>
        <tr>
          <td><code>setLong</code></td>
          <td><code>Long/Option[Long]</code></td>
          <td></td>
        </tr>
        <tr>
          <td><code>setBigInt</code></td>
          <td><code>BigInt/Option[BigInt]</code></td>
          <td></td>
        </tr>
        <tr>
          <td><code>setFloat</code></td>
          <td><code>Float/Option[Float]</code></td>
          <td></td>
        </tr>
        <tr>
          <td><code>setDouble</code></td>
          <td><code>Double/Option[Double]</code></td>
          <td></td>
        </tr>
        <tr>
          <td><code>setBigDecimal</code></td>
          <td><code>BigDecimal/Option[BigDecimal]</code></td>
          <td></td>
        </tr>
        <tr>
          <td><code>setString</code></td>
          <td><code>String/Option[String]</code></td>
          <td></td>
        </tr>
        <tr>
          <td><code>setBytes</code></td>
          <td><code>Array[Byte]/Option[Array[Byte]]</code></td>
          <td></td>
        </tr>
        <tr>
          <td><code>setDate</code></td>
          <td><code>LocalDate/Option[LocalDate]</code></td>
          <td><code>java.sql</code>ではなく<code>java.time</code>を直接扱います。</td>
        </tr>
        <tr>
          <td><code>setTime</code></td>
          <td><code>LocalTime/Option[LocalTime]</code></td>
          <td><code>java.sql</code>ではなく<code>java.time</code>を直接扱います。</td>
        </tr>
        <tr>
          <td><code>setTimestamp</code></td>
          <td><code>LocalDateTime/Option[LocalDateTime]</code></td>
          <td><code>java.sql</code>ではなく<code>java.time</code>を直接扱います。</td>
        </tr>
        <tr>
          <td><code>setYear</code></td>
          <td><code>Year/Option[Year]</code></td>
          <td><code>java.sql</code>ではなく<code>java.time</code>を直接扱います。</td>
        </tr>
      </tbody>
    </table>
    
    <h4 id="書き込みクエリ-2" class="section"><a class="anchor-link left" href="#書き込みクエリ-2"><i class="icofont-laika link">&#xef71;</i></a>書き込みクエリ</h4>
    <p>書き込みを行うSQLを実行する場合は<code>executeUpdate</code>メソッドを使用します。</p>
    <p>クエリを実行した結果MySQLサーバーから返される値は影響を受けた行数が戻り値として返却されます。</p>
    <pre class="keep-together pdf epub"><code class="nohighlight"><span class="identifier">connection</span><span>.</span><span class="identifier">use</span><span> { </span><span class="identifier">conn</span><span> =&gt;
  </span><span class="keyword">for</span><span> 
    </span><span class="identifier">statement</span><span> &lt;- </span><span class="identifier">conn</span><span>.</span><span class="identifier">clientPreparedStatement</span><span>(</span><span class="string-literal">&quot;INSERT INTO users (name, age) VALUES (?, ?)&quot;</span><span>) </span><span class="comment">// or conn.serverPreparedStatement(&quot;INSERT INTO users (name, age) VALUES (?, ?)&quot;)
</span><span>    </span><span class="identifier">_</span><span> &lt;- </span><span class="identifier">statement</span><span>.</span><span class="identifier">setString</span><span>(</span><span class="number-literal">1</span><span>, </span><span class="string-literal">&quot;Alice&quot;</span><span>)
    </span><span class="identifier">_</span><span> &lt;- </span><span class="identifier">statement</span><span>.</span><span class="identifier">setInt</span><span>(</span><span class="number-literal">2</span><span>, </span><span class="number-literal">20</span><span>)
    </span><span class="identifier">result</span><span> &lt;- </span><span class="identifier">statement</span><span>.</span><span class="identifier">executeUpdate</span><span>()
  </span><span class="keyword">yield</span><span> </span><span class="identifier">result</span><span>
}</span></code></pre>
    
    <h4 id="auto_incrementの値を取得-2" class="section"><a class="anchor-link left" href="#auto_incrementの値を取得-2"><i class="icofont-laika link">&#xef71;</i></a>AUTO_INCREMENTの値を取得</h4>
    <p>クエリ実行後にAUTO_INCREMENTの値を取得する場合は<code>getGeneratedKeys</code>メソッドを使用します。</p>
    <p>クエリを実行した結果MySQLサーバーから返される値はAUTO_INCREMENTに生成された値が戻り値として返却されます。</p>
    <pre class="keep-together pdf epub"><code class="nohighlight"><span class="identifier">connection</span><span>.</span><span class="identifier">use</span><span> { </span><span class="identifier">conn</span><span> =&gt;
  </span><span class="keyword">for</span><span> 
    </span><span class="identifier">statement</span><span> &lt;- </span><span class="identifier">conn</span><span>.</span><span class="identifier">clientPreparedStatement</span><span>(</span><span class="string-literal">&quot;INSERT INTO users (name, age) VALUES (?, ?)&quot;</span><span>, </span><span class="type-name">Statement</span><span>.</span><span class="type-name">RETURN_GENERATED_KEYS</span><span>) </span><span class="comment">// or conn.serverPreparedStatement(&quot;INSERT INTO users (name, age) VALUES (?, ?)&quot;, Statement.RETURN_GENERATED_KEYS)
</span><span>    </span><span class="identifier">_</span><span> &lt;- </span><span class="identifier">statement</span><span>.</span><span class="identifier">setString</span><span>(</span><span class="number-literal">1</span><span>, </span><span class="string-literal">&quot;Alice&quot;</span><span>)
    </span><span class="identifier">_</span><span> &lt;- </span><span class="identifier">statement</span><span>.</span><span class="identifier">setInt</span><span>(</span><span class="number-literal">2</span><span>, </span><span class="number-literal">20</span><span>)
    </span><span class="identifier">_</span><span> &lt;- </span><span class="identifier">statement</span><span>.</span><span class="identifier">executeUpdate</span><span>()
    </span><span class="identifier">getGeneratedKeys</span><span> &lt;- </span><span class="identifier">statement</span><span>.</span><span class="identifier">getGeneratedKeys</span><span>()
  </span><span class="keyword">yield</span><span> </span><span class="identifier">getGeneratedKeys</span><span>
}</span></code></pre>
    
    <h3 id="resultset" class="section"><a class="anchor-link left" href="#resultset"><i class="icofont-laika link">&#xef71;</i></a>ResultSet</h3>
    <p><code>ResultSet</code>はクエリ実行後にMySQLサーバーから返された値を格納するためのAPIです。</p>
    <p>SQLを実行して取得したレコードを<code>ResultSet</code>から取得するにはJDBCと同じように<code>next</code>メソッドと<code>getXXX</code>メソッドを使用して取得する方法と、ldbc独自の<code>decode</code>メソッドを使用する方法があります。</p>
    
    <h4 id="next-getxxx" class="section"><a class="anchor-link left" href="#next-getxxx"><i class="icofont-laika link">&#xef71;</i></a>next/getXXX</h4>
    <p><code>next</code>メソッドは次のレコードが存在する場合は<code>true</code>を返却し、次のレコードが存在しない場合は<code>false</code>を返却します。</p>
    <p><code>getXXX</code>メソッドはレコードから値を取得するためのAPIです。</p>
    <p><code>getXXX</code>メソッドは取得するカラムのインデックスを指定する方法とカラム名を指定する方法があります。</p>
    <pre><code class="nohighlight"><span class="identifier">connection</span><span>.</span><span class="identifier">use</span><span> { </span><span class="identifier">conn</span><span> =&gt;
  </span><span class="keyword">for</span><span> 
    </span><span class="identifier">statement</span><span> &lt;- </span><span class="identifier">conn</span><span>.</span><span class="identifier">clientPreparedStatement</span><span>(</span><span class="string-literal">&quot;SELECT `id`, `name`, `age` FROM users WHERE id = ?&quot;</span><span>)
    </span><span class="identifier">_</span><span> &lt;- </span><span class="identifier">statement</span><span>.</span><span class="identifier">setLong</span><span>(</span><span class="number-literal">1</span><span>, </span><span class="number-literal">1</span><span>)
    </span><span class="identifier">result</span><span> &lt;- </span><span class="identifier">statement</span><span>.</span><span class="identifier">executeQuery</span><span>()
    </span><span class="identifier">records</span><span> &lt;- </span><span class="type-name">Monad</span><span>[</span><span class="type-name">IO</span><span>].</span><span class="identifier">whileM</span><span>(</span><span class="identifier">result</span><span>.</span><span class="identifier">next</span><span>()) {
      </span><span class="keyword">for</span><span>
        </span><span class="identifier">id</span><span> &lt;- </span><span class="identifier">result</span><span>.</span><span class="identifier">getLong</span><span>(</span><span class="number-literal">1</span><span>)
        </span><span class="identifier">name</span><span> &lt;- </span><span class="identifier">result</span><span>.</span><span class="identifier">getString</span><span>(</span><span class="string-literal">&quot;name&quot;</span><span>)
        </span><span class="identifier">age</span><span> &lt;- </span><span class="identifier">result</span><span>.</span><span class="identifier">getInt</span><span>(</span><span class="number-literal">3</span><span>)  
      </span><span class="keyword">yield</span><span> (</span><span class="identifier">id</span><span>, </span><span class="identifier">name</span><span>, </span><span class="identifier">age</span><span>)
  }
  </span><span class="keyword">yield</span><span> </span><span class="identifier">records</span><span>
}</span></code></pre>
    
    <h4 id="decode" class="section"><a class="anchor-link left" href="#decode"><i class="icofont-laika link">&#xef71;</i></a>decode</h4>
    <p><code>decode</code>メソッドは<code>ResultSet</code>から取得した値をScalaの型に変換して取得するためのAPIです。</p>
    <p>取得するカラムの数に応じて<code>*:</code>演算子を使用して変換する型を指定します。</p>
    <p>例では、usersテーブルのid, name, ageカラムを取得する場合を示しておりそれぞれのカラムの型を指定しています。</p>
    <pre class="keep-together pdf epub"><code class="nohighlight"><span class="identifier">result</span><span>.</span><span class="identifier">decode</span><span>(</span><span class="identifier">bigint</span><span> *: </span><span class="identifier">varchar</span><span> *: </span><span class="identifier">int</span><span>.</span><span class="identifier">opt</span><span>)</span></code></pre>
    <p>NULL許容のカラムを取得する場合は<code>Option</code>型に変換するために<code>opt</code>メソッドを使用します。
    これによりレコードがNULLの場合はNoneとして取得することができます。</p>
    <p>クエリ実行からレコード取得までの一連の流れは以下のようになります。</p>
    <pre class="keep-together pdf epub"><code class="nohighlight"><span class="identifier">connection</span><span>.</span><span class="identifier">use</span><span> { </span><span class="identifier">conn</span><span> =&gt;
  </span><span class="keyword">for</span><span> 
    </span><span class="identifier">statement</span><span> &lt;- </span><span class="identifier">conn</span><span>.</span><span class="identifier">clientPreparedStatement</span><span>(</span><span class="string-literal">&quot;SELECT * FROM users WHERE id = ?&quot;</span><span>) </span><span class="comment">// or conn.serverPreparedStatement(&quot;SELECT * FROM users WHERE id = ?&quot;)
</span><span>    </span><span class="identifier">_</span><span> &lt;- </span><span class="identifier">statement</span><span>.</span><span class="identifier">setLong</span><span>(</span><span class="number-literal">1</span><span>, </span><span class="number-literal">1</span><span>)
    </span><span class="identifier">result</span><span> &lt;- </span><span class="identifier">statement</span><span>.</span><span class="identifier">executeQuery</span><span>()
    </span><span class="identifier">decodes</span><span> &lt;- </span><span class="identifier">result</span><span>.</span><span class="identifier">decode</span><span>(</span><span class="identifier">bigint</span><span> *: </span><span class="identifier">varchar</span><span> *: </span><span class="identifier">int</span><span>.</span><span class="identifier">opt</span><span>)
  </span><span class="keyword">yield</span><span> </span><span class="identifier">decodes</span><span>
}</span></code></pre>
    <p><code>ResultSet</code>から取得するレコードは常に配列になります。
    これはMySQLで実行するクエリの結果が常に複数のレコードを返す可能性があるからです。</p>
    <p>単一のレコードを取得する場合は<code>decode</code>処理後に、<code>head</code>や<code>headOption</code>メソッドを使用して取得を行なってください。</p>
    <p>現在のバージョンでは以下のデータ型がサポートされています。</p>
    <table>
      <thead>
        <tr>
          <th>Codec</th>
          <th>データ型</th>
          <th>Scala 型</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><code>boolean</code></td>
          <td><code>BOOLEAN</code></td>
          <td><code>Boolean</code></td>
        </tr>
        <tr>
          <td><code>tinyint</code></td>
          <td><code>TINYINT</code></td>
          <td><code>Byte</code></td>
        </tr>
        <tr>
          <td><code>utinyint</code></td>
          <td><code>unsigned TINYINT</code></td>
          <td><code>Short</code></td>
        </tr>
        <tr>
          <td><code>smallint</code></td>
          <td><code>SMALLINT</code></td>
          <td><code>Short</code></td>
        </tr>
        <tr>
          <td><code>usmallint</code></td>
          <td><code>unsigned SMALLINT</code></td>
          <td><code>Int</code></td>
        </tr>
        <tr>
          <td><code>int</code></td>
          <td><code>INT</code></td>
          <td><code>Int</code></td>
        </tr>
        <tr>
          <td><code>uint</code></td>
          <td><code>unsigned INT</code></td>
          <td><code>Long</code></td>
        </tr>
        <tr>
          <td><code>bigint</code></td>
          <td><code>BIGINT</code></td>
          <td><code>Long</code></td>
        </tr>
        <tr>
          <td><code>ubigint</code></td>
          <td><code>unsigned BIGINT</code></td>
          <td><code>BigInt</code></td>
        </tr>
        <tr>
          <td><code>float</code></td>
          <td><code>FLOAT</code></td>
          <td><code>Float</code></td>
        </tr>
        <tr>
          <td><code>double</code></td>
          <td><code>DOUBLE</code></td>
          <td><code>Double</code></td>
        </tr>
        <tr>
          <td><code>decimal</code></td>
          <td><code>DECIMAL</code></td>
          <td><code>BigDecimal</code></td>
        </tr>
        <tr>
          <td><code>char</code></td>
          <td><code>CHAR</code></td>
          <td><code>String</code></td>
        </tr>
        <tr>
          <td><code>varchar</code></td>
          <td><code>VARCHAR</code></td>
          <td><code>String</code></td>
        </tr>
        <tr>
          <td><code>binary</code></td>
          <td><code>BINARY</code></td>
          <td><code>Array[Byte]</code></td>
        </tr>
        <tr>
          <td><code>varbinary</code></td>
          <td><code>VARBINARY</code></td>
          <td><code>String</code></td>
        </tr>
        <tr>
          <td><code>tinyblob</code></td>
          <td><code>TINYBLOB</code></td>
          <td><code>String</code></td>
        </tr>
        <tr>
          <td><code>blob</code></td>
          <td><code>BLOB</code></td>
          <td><code>String</code></td>
        </tr>
        <tr>
          <td><code>mediumblob</code></td>
          <td><code>MEDIUMBLOB</code></td>
          <td><code>String</code></td>
        </tr>
        <tr>
          <td><code>longblob</code></td>
          <td><code>LONGBLOB</code></td>
          <td><code>String</code></td>
        </tr>
        <tr>
          <td><code>tinytext</code></td>
          <td><code>TINYTEXT</code></td>
          <td><code>String</code></td>
        </tr>
        <tr>
          <td><code>text</code></td>
          <td><code>TEXT</code></td>
          <td><code>String</code></td>
        </tr>
        <tr>
          <td><code>mediumtext</code></td>
          <td><code>MEDIUMTEXT</code></td>
          <td><code>String</code></td>
        </tr>
        <tr>
          <td><code>longtext</code></td>
          <td><code>LONGTEXT</code></td>
          <td><code>String</code></td>
        </tr>
        <tr>
          <td><code>enum</code></td>
          <td><code>ENUM</code></td>
          <td><code>String</code></td>
        </tr>
        <tr>
          <td><code>set</code></td>
          <td><code>SET</code></td>
          <td><code>List[String]</code></td>
        </tr>
        <tr>
          <td><code>json</code></td>
          <td><code>JSON</code></td>
          <td><code>String</code></td>
        </tr>
        <tr>
          <td><code>date</code></td>
          <td><code>DATE</code></td>
          <td><code>LocalDate</code></td>
        </tr>
        <tr>
          <td><code>time</code></td>
          <td><code>TIME</code></td>
          <td><code>LocalTime</code></td>
        </tr>
        <tr>
          <td><code>timetz</code></td>
          <td><code>TIME</code></td>
          <td><code>OffsetTime</code></td>
        </tr>
        <tr>
          <td><code>datetime</code></td>
          <td><code>DATETIME</code></td>
          <td><code>LocalDateTime</code></td>
        </tr>
        <tr>
          <td><code>timestamp</code></td>
          <td><code>TIMESTAMP</code></td>
          <td><code>LocalDateTime</code></td>
        </tr>
        <tr>
          <td><code>timestamptz</code></td>
          <td><code>TIMESTAMP</code></td>
          <td><code>OffsetDateTime</code></td>
        </tr>
        <tr>
          <td><code>year</code></td>
          <td><code>YEAR</code></td>
          <td><code>Year</code></td>
        </tr>
      </tbody>
    </table>
    <p>※ 現在MySQLのデータ型を指定して値を取得するような作りとなっていますが、将来的にはより簡潔にScalaの型を指定して値を取得するような作りに変更する可能性があります。</p>
    <p>以下サポートされていないデータ型があります。</p>
    <ul>
      <li>GEOMETRY</li>
      <li>POINT</li>
      <li>LINESTRING</li>
      <li>POLYGON</li>
      <li>MULTIPOINT</li>
      <li>MULTILINESTRING</li>
      <li>MULTIPOLYGON</li>
      <li>GEOMETRYCOLLECTION</li>
    </ul>
    
    <h2 id="トランザクション" class="section"><a class="anchor-link left" href="#トランザクション"><i class="icofont-laika link">&#xef71;</i></a>トランザクション</h2>
    <p><code>Connection</code>を使用してトランザクションを実行するためには<code>setAutoCommit</code>メソッドと<code>commit</code>メソッド、<code>rollback</code>メソッドを組み合わせて使用します。</p>
    <p>まず、<code>setAutoCommit</code>メソッドを使用してトランザクションの自動コミットを無効にします。</p>
    <pre class="keep-together pdf epub"><code class="nohighlight"><span class="identifier">conn</span><span>.</span><span class="identifier">setAutoCommit</span><span>(</span><span class="boolean-literal">false</span><span>)</span></code></pre>
    <p>何かしらの処理を行った後に<code>commit</code>メソッドを使用してトランザクションをコミットします。</p>
    <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">for</span><span>
  </span><span class="identifier">statement</span><span> &lt;- </span><span class="identifier">conn</span><span>.</span><span class="identifier">clientPreparedStatement</span><span>(</span><span class="string-literal">&quot;INSERT INTO users (name, age) VALUES (?, ?)&quot;</span><span>)
  </span><span class="identifier">_</span><span> &lt;- </span><span class="identifier">statement</span><span>.</span><span class="identifier">setString</span><span>(</span><span class="number-literal">1</span><span>, </span><span class="string-literal">&quot;Alice&quot;</span><span>)
  </span><span class="identifier">_</span><span> &lt;- </span><span class="identifier">statement</span><span>.</span><span class="identifier">setInt</span><span>(</span><span class="number-literal">2</span><span>, </span><span class="number-literal">20</span><span>)
  </span><span class="identifier">result</span><span> &lt;- </span><span class="identifier">statement</span><span>.</span><span class="identifier">executeUpdate</span><span>()
  </span><span class="identifier">_</span><span> &lt;- </span><span class="identifier">conn</span><span>.</span><span class="identifier">commit</span><span>()
</span><span class="keyword">yield</span></code></pre>
    <p>もしくは、<code>rollback</code>メソッドを使用してトランザクションをロールバックします。</p>
    <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">for</span><span>
  </span><span class="identifier">statement</span><span> &lt;- </span><span class="identifier">conn</span><span>.</span><span class="identifier">clientPreparedStatement</span><span>(</span><span class="string-literal">&quot;INSERT INTO users (name, age) VALUES (?, ?)&quot;</span><span>)
  </span><span class="identifier">_</span><span> &lt;- </span><span class="identifier">statement</span><span>.</span><span class="identifier">setString</span><span>(</span><span class="number-literal">1</span><span>, </span><span class="string-literal">&quot;Alice&quot;</span><span>)
  </span><span class="identifier">_</span><span> &lt;- </span><span class="identifier">statement</span><span>.</span><span class="identifier">setInt</span><span>(</span><span class="number-literal">2</span><span>, </span><span class="number-literal">20</span><span>)
  </span><span class="identifier">result</span><span> &lt;- </span><span class="identifier">statement</span><span>.</span><span class="identifier">executeUpdate</span><span>()
  </span><span class="identifier">_</span><span> &lt;- </span><span class="identifier">conn</span><span>.</span><span class="identifier">rollback</span><span>()
</span><span class="keyword">yield</span></code></pre>
    <p><code>setAutoCommit</code>メソッドを使用してトランザクションの自動コミットを無効にした場合、コネクションのResourceを解放する際に自動的にロールバックが行われます。</p>
    
    <h3 id="トランザクション分離レベル" class="section"><a class="anchor-link left" href="#トランザクション分離レベル"><i class="icofont-laika link">&#xef71;</i></a>トランザクション分離レベル</h3>
    <p>ldbcではトランザクション分離レベルの設定を行うことができます。</p>
    <p>トランザクション分離レベルは<code>setTransactionIsolation</code>メソッドを使用して設定を行います。</p>
    <p>MySQLでは以下のトランザクション分離レベルがサポートされています。</p>
    <ul>
      <li>READ UNCOMMITTED</li>
      <li>READ COMMITTED</li>
      <li>REPEATABLE READ</li>
      <li>SERIALIZABLE</li>
    </ul>
    <p>MySQLのトランザクション分離レベルについては<a href="https://dev.mysql.com/doc/refman/8.0/ja/innodb-transaction-isolation-levels.html">公式ドキュメント</a>を参照してください。</p>
    <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">ldbc</span><span>.</span><span class="identifier">connector</span><span>.</span><span class="type-name">Connection</span><span>.</span><span class="type-name">TransactionIsolationLevel</span><span>

</span><span class="identifier">conn</span><span>.</span><span class="identifier">setTransactionIsolation</span><span>(</span><span class="type-name">TransactionIsolationLevel</span><span>.</span><span class="type-name">REPEATABLE_READ</span><span>)</span></code></pre>
    <p>現在設定されているトランザクション分離レベルを取得するには<code>getTransactionIsolation</code>メソッドを使用します。</p>
    <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">for</span><span>
  </span><span class="identifier">isolationLevel</span><span> &lt;- </span><span class="identifier">conn</span><span>.</span><span class="identifier">getTransactionIsolation</span><span>()
</span><span class="keyword">yield</span></code></pre>
    
    <h3 id="セーブポイント" class="section"><a class="anchor-link left" href="#セーブポイント"><i class="icofont-laika link">&#xef71;</i></a>セーブポイント</h3>
    <p>より高度なトランザクション管理のために「Savepoint機能」を使用することができます。これにより、データベース操作中に特定のポイントをマークしておくことが可能になり、何か問題が発生した場合にも、そのポイントまでデータベースの状態を巻き戻すことができます。これは、複雑なデータベース操作や、長いトランザクションの中での安全なポイント設定を必要とする場合に特に役立ちます。</p>
    <p><strong>特徴：</strong></p>
    <ul>
      <li>柔軟なトランザクション管理：Savepointを使って、トランザクション内の任意の場所で「チェックポイント」を作成。必要に応じてそのポイントまで状態を戻すことができます。 </li>
      <li>エラー回復：エラーが発生した時、全てを最初からやり直すのではなく、最後の安全なSavepointまで戻ることで、時間の節約と効率の向上が見込めます。 </li>
      <li>高度な制御：複数のSavepointを設定することで、より精密なトランザクション制御が可能に。開発者はより複雑なロジックやエラーハンドリングを簡単に実装できます。</li>
    </ul>
    <p>この機能を活用することで、あなたのアプリケーションはより堅牢で信頼性の高いデータベース操作を実現できるようになります。</p>
    <p><strong>セーブポイントの設定</strong></p>
    <p>Savepointを設定するには、<code>setSavepoint</code>メソッドを使用します。このメソッドは、Savepointの名前を指定することができます。
    Savepointの名前を指定しない場合、デフォルトの名前としてUUIDで生成された値が設定されます。</p>
    <p><code>getSavepointName</code>メソッドを使用して、設定されたSavepointの名前を取得することができます。</p>
    <p>※ MySQLではデフォルトで自動コミットが有効になっているため、Savepointを使用する場合は自動コミットを無効にする必要があります。そうしないと全ての処理が都度コミットされてしまうため、Savepointを使用したトランザクションのロールバックを行うことができなくなるためです。</p>
    <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">for</span><span>
  </span><span class="identifier">_</span><span> &lt;- </span><span class="identifier">conn</span><span>.</span><span class="identifier">setAutoCommit</span><span>(</span><span class="boolean-literal">false</span><span>)
  </span><span class="identifier">savepoint</span><span> &lt;- </span><span class="identifier">conn</span><span>.</span><span class="identifier">setSavepoint</span><span>(</span><span class="string-literal">&quot;savepoint1&quot;</span><span>)
</span><span class="keyword">yield</span><span> </span><span class="identifier">savepoint</span><span>.</span><span class="identifier">getSavepointName</span></code></pre>
    <p><strong>セーブポイントのロールバック</strong></p>
    <p>Savepointを使用してトランザクションの一部をロールバックするには、<code>rollback</code>メソッドにSavepointを渡すことでロールバックを行います。
    Savepointを使用して部分的にロールバックをした後、トランザクション全体をコミットするとそのSavepoint以降のトランザクションはコミットされません。</p>
    <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">for</span><span>
  </span><span class="identifier">_</span><span> &lt;- </span><span class="identifier">conn</span><span>.</span><span class="identifier">setAutoCommit</span><span>(</span><span class="boolean-literal">false</span><span>)
  </span><span class="identifier">savepoint</span><span> &lt;- </span><span class="identifier">conn</span><span>.</span><span class="identifier">setSavepoint</span><span>(</span><span class="string-literal">&quot;savepoint1&quot;</span><span>)
  </span><span class="identifier">_</span><span> &lt;- </span><span class="identifier">conn</span><span>.</span><span class="identifier">rollback</span><span>(</span><span class="identifier">savepoint</span><span>)
  </span><span class="identifier">_</span><span> &lt;- </span><span class="identifier">conn</span><span>.</span><span class="identifier">commit</span><span>()
</span><span class="keyword">yield</span></code></pre>
    <p><strong>セーブポイントのリリース</strong></p>
    <p>Savepointをリリースするには、<code>releaseSavepoint</code>メソッドにSavepointを渡すことでリリースを行います。
    Savepointをリリースした後、トランザクション全体をコミットするとそのSavepoint以降のトランザクションはコミットされます。</p>
    <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">for</span><span>
  </span><span class="identifier">_</span><span> &lt;- </span><span class="identifier">conn</span><span>.</span><span class="identifier">setAutoCommit</span><span>(</span><span class="boolean-literal">false</span><span>)
  </span><span class="identifier">savepoint</span><span> &lt;- </span><span class="identifier">conn</span><span>.</span><span class="identifier">setSavepoint</span><span>(</span><span class="string-literal">&quot;savepoint1&quot;</span><span>)
  </span><span class="identifier">_</span><span> &lt;- </span><span class="identifier">conn</span><span>.</span><span class="identifier">releaseSavepoint</span><span>(</span><span class="identifier">savepoint</span><span>)
  </span><span class="identifier">_</span><span> &lt;- </span><span class="identifier">conn</span><span>.</span><span class="identifier">commit</span><span>()
</span><span class="keyword">yield</span></code></pre>
    
    <h2 id="ユーティリティコマンド" class="section"><a class="anchor-link left" href="#ユーティリティコマンド"><i class="icofont-laika link">&#xef71;</i></a>ユーティリティコマンド</h2>
    <p>MySQLにはいくつかのユーティリティコマンドがあります。(<a href="https://dev.mysql.com/doc/dev/mysql-server/latest/page_protocol_command_phase_utility.html">参照</a>)</p>
    <p>ldbcではこれらのコマンドを使用するためのAPIを提供しています。</p>
    <table>
      <thead>
        <tr>
          <th>コマンド</th>
          <th>用途</th>
          <th>サポート</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><code>COM_QUIT</code></td>
          <td><code>クライアントが接続を閉じることをサーバーに要求していることを伝える。</code></td>
          <td>✅</td>
        </tr>
        <tr>
          <td><code>COM_INIT_DB</code></td>
          <td><code>接続のデフォルト・スキーマを変更する</code></td>
          <td>✅</td>
        </tr>
        <tr>
          <td><code>COM_STATISTICS</code></td>
          <td><code>内部ステータスの文字列を可読形式で取得する。</code></td>
          <td>✅</td>
        </tr>
        <tr>
          <td><code>COM_DEBUG</code></td>
          <td><code>サーバーの標準出力にデバッグ情報をダンプする</code></td>
          <td>❌</td>
        </tr>
        <tr>
          <td><code>COM_PING</code></td>
          <td><code>サーバーが生きているかチェックする</code></td>
          <td>✅</td>
        </tr>
        <tr>
          <td><code>COM_CHANGE_USER</code></td>
          <td><code>現在の接続のユーザーを変更する</code></td>
          <td>✅</td>
        </tr>
        <tr>
          <td><code>COM_RESET_CONNECTION</code></td>
          <td><code>セッションの状態をリセットする</code></td>
          <td>✅</td>
        </tr>
        <tr>
          <td><code>COM_SET_OPTION</code></td>
          <td><code>現在の接続のオプションを設定する</code></td>
          <td>✅</td>
        </tr>
      </tbody>
    </table>
    
    <h3 id="com-quit" class="section"><a class="anchor-link left" href="#com-quit"><i class="icofont-laika link">&#xef71;</i></a>COM QUIT</h3>
    <p><code>COM_QUIT</code>はクライアントが接続を閉じることをサーバーに要求していることを伝えるためのコマンドです。</p>
    <p>ldbcでは<code>Connection</code>の<code>close</code>メソッドを使用して接続を閉じることができます。
    <code>close</code>メソッドを使用すると接続が閉じられるため、その後の処理で接続を使用することはできません。</p>
    <p>※ <code>Connection</code>は<code>Resource</code>を使用してリソース管理を行います。そのため<code>close</code>メソッドを使用してリソースの解放を行う必要はありません。</p>
    <pre class="keep-together pdf epub"><code class="nohighlight"><span class="identifier">connection</span><span>.</span><span class="identifier">use</span><span> { </span><span class="identifier">conn</span><span> =&gt;
  </span><span class="identifier">conn</span><span>.</span><span class="identifier">close</span><span>()
}</span></code></pre>
    
    <h3 id="com-init-db" class="section"><a class="anchor-link left" href="#com-init-db"><i class="icofont-laika link">&#xef71;</i></a>COM INIT DB</h3>
    <p><code>COM_INIT_DB</code>は接続のデフォルト・スキーマを変更するためのコマンドです。</p>
    <p>ldbcでは<code>Connection</code>の<code>setSchema</code>メソッドを使用してデフォルト・スキーマを変更することができます。</p>
    <pre class="keep-together pdf epub"><code class="nohighlight"><span class="identifier">connection</span><span>.</span><span class="identifier">use</span><span> { </span><span class="identifier">conn</span><span> =&gt;
  </span><span class="identifier">conn</span><span>.</span><span class="identifier">setSchema</span><span>(</span><span class="string-literal">&quot;test&quot;</span><span>)
}</span></code></pre>
    
    <h3 id="com-statistics" class="section"><a class="anchor-link left" href="#com-statistics"><i class="icofont-laika link">&#xef71;</i></a>COM STATISTICS</h3>
    <p><code>COM_STATISTICS</code>は内部ステータスの文字列を可読形式で取得するためのコマンドです。</p>
    <p>ldbcでは<code>Connection</code>の<code>getStatistics</code>メソッドを使用して内部ステータスの文字列を取得することができます。</p>
    <pre class="keep-together pdf epub"><code class="nohighlight"><span class="identifier">connection</span><span>.</span><span class="identifier">use</span><span> { </span><span class="identifier">conn</span><span> =&gt;
  </span><span class="identifier">conn</span><span>.</span><span class="identifier">getStatistics</span><span>
}</span></code></pre>
    <p>取得できるステータスは以下のようになります。</p>
    <ul>
      <li><code>uptime</code> : サーバーが起動してからの時間</li>
      <li><code>threads</code> : 現在接続しているクライアントの数</li>
      <li><code>questions</code> : サーバーが起動してからのクエリの数</li>
      <li><code>slowQueries</code> : 遅いクエリの数</li>
      <li><code>opens</code> : サーバーが起動してからのテーブルのオープン数</li>
      <li><code>flushTables</code> : サーバーが起動してからのテーブルのフラッシュ数</li>
      <li><code>openTables</code> : 現在オープンしているテーブルの数</li>
      <li><code>queriesPerSecondAvg</code> : 秒間のクエリの平均数</li>
    </ul>
    
    <h3 id="com-ping" class="section"><a class="anchor-link left" href="#com-ping"><i class="icofont-laika link">&#xef71;</i></a>COM PING</h3>
    <p><code>COM_PING</code>はサーバーが生きているかチェックするためのコマンドです。</p>
    <p>ldbcでは<code>Connection</code>の<code>isValid</code>メソッドを使用してサーバーが生きているかチェックすることができます。
    サーバーが生きている場合は<code>true</code>を返却し、生きていない場合は<code>false</code>を返却します。</p>
    <pre class="keep-together pdf epub"><code class="nohighlight"><span class="identifier">connection</span><span>.</span><span class="identifier">use</span><span> { </span><span class="identifier">conn</span><span> =&gt;
  </span><span class="identifier">conn</span><span>.</span><span class="identifier">isValid</span><span>
}</span></code></pre>
    
    <h3 id="com-change-user" class="section"><a class="anchor-link left" href="#com-change-user"><i class="icofont-laika link">&#xef71;</i></a>COM CHANGE USER</h3>
    <p><code>COM_CHANGE_USER</code>は現在の接続のユーザーを変更するためのコマンドです。
    また、以下の接続状態をリセットします。</p>
    <ul>
      <li>ユーザー変数 </li>
      <li>一時テーブル </li>
      <li>プリペアド・ステートメント </li>
      <li>etc...</li>
    </ul>
    <p>ldbcでは<code>Connection</code>の<code>changeUser</code>メソッドを使用してユーザーを変更することができます。</p>
    <pre class="keep-together pdf epub"><code class="nohighlight"><span class="identifier">connection</span><span>.</span><span class="identifier">use</span><span> { </span><span class="identifier">conn</span><span> =&gt;
  </span><span class="identifier">conn</span><span>.</span><span class="identifier">changeUser</span><span>(</span><span class="string-literal">&quot;root&quot;</span><span>, </span><span class="string-literal">&quot;password&quot;</span><span>)
}</span></code></pre>
    
    <h3 id="com-reset-connection" class="section"><a class="anchor-link left" href="#com-reset-connection"><i class="icofont-laika link">&#xef71;</i></a>COM RESET CONNECTION</h3>
    <p><code>COM_RESET_CONNECTION</code>はセッションの状態をリセットするためのコマンドです。</p>
    <p><code>COM_RESET_CONNECTION</code>は<code>COM_CHANGE_USER</code>をより軽量化したもので、セッションの状態をクリーンアップする機能はほぼ同じだが、次のような機能がある</p>
    <ul>
      <li>再認証を行わない（そのために余分なクライアント/サーバ交換を行わない）。</li>
      <li>接続を閉じない。</li>
    </ul>
    <p>ldbcでは<code>Connection</code>の<code>resetServerState</code>メソッドを使用してセッションの状態をリセットすることができます。</p>
    <pre class="keep-together pdf epub"><code class="nohighlight"><span class="identifier">connection</span><span>.</span><span class="identifier">use</span><span> { </span><span class="identifier">conn</span><span> =&gt;
  </span><span class="identifier">conn</span><span>.</span><span class="identifier">resetServerState</span><span>
}</span></code></pre>
    
    <h3 id="com-set-option" class="section"><a class="anchor-link left" href="#com-set-option"><i class="icofont-laika link">&#xef71;</i></a>COM SET OPTION</h3>
    <p><code>COM_SET_OPTION</code>は現在の接続のオプションを設定するためのコマンドです。</p>
    <p>ldbcでは<code>Connection</code>の<code>enableMultiQueries</code>メソッドと<code>disableMultiQueries</code>メソッドを使用してオプションを設定することができます。</p>
    <p><code>enableMultiQueries</code>メソッドを使用すると、複数のクエリを一度に実行することができます。
    <code>disableMultiQueries</code>メソッドを使用すると、複数のクエリを一度に実行することができなくなります。</p>
    <p>※ これは、Insert、Update、および Delete ステートメントによるバッチ処理にのみ使用できます。Selectステートメントで使用を行なったとしても、最初のクエリの結果のみが返されます。</p>
    <pre class="keep-together pdf epub"><code class="nohighlight"><span class="identifier">connection</span><span>.</span><span class="identifier">use</span><span> { </span><span class="identifier">conn</span><span> =&gt;
  </span><span class="identifier">conn</span><span>.</span><span class="identifier">enableMultiQueries</span><span> *&gt; </span><span class="identifier">conn</span><span>.</span><span class="identifier">disableMultiQueries</span><span>
}</span></code></pre>
    
    <h2 id="バッチコマンド" class="section"><a class="anchor-link left" href="#バッチコマンド"><i class="icofont-laika link">&#xef71;</i></a>バッチコマンド</h2>
    <p>ldbcではバッチコマンドを使用して複数のクエリを一度に実行することができます。
    バッチコマンドを使用することで、複数のクエリを一度に実行することができるため、ネットワークラウンドトリップの回数を減らすことができます。</p>
    <p>バッチコマンドを使用するには<code>Statement</code>または<code>PreparedStatement</code>の<code>addBatch</code>メソッドを使用してクエリを追加し、<code>executeBatch</code>メソッドを使用してクエリを実行します。</p>
    <pre class="keep-together pdf epub"><code class="nohighlight"><span class="identifier">connection</span><span>.</span><span class="identifier">use</span><span> { </span><span class="identifier">conn</span><span> =&gt;
  </span><span class="keyword">for</span><span>
    </span><span class="identifier">statement</span><span> &lt;- </span><span class="identifier">conn</span><span>.</span><span class="identifier">createStatement</span><span>()
    </span><span class="identifier">_</span><span> &lt;- </span><span class="identifier">statement</span><span>.</span><span class="identifier">addBatch</span><span>(</span><span class="string-literal">&quot;INSERT INTO users (name, age) VALUES (&#39;Alice&#39;, 20)&quot;</span><span>)
    </span><span class="identifier">_</span><span> &lt;- </span><span class="identifier">statement</span><span>.</span><span class="identifier">addBatch</span><span>(</span><span class="string-literal">&quot;INSERT INTO users (name, age) VALUES (&#39;Bob&#39;, 30)&quot;</span><span>)
    </span><span class="identifier">result</span><span> &lt;- </span><span class="identifier">statement</span><span>.</span><span class="identifier">executeBatch</span><span>()
  </span><span class="keyword">yield</span><span> </span><span class="identifier">result</span><span>
}</span></code></pre>
    <p>上記の例では、<code>Alice</code>と<code>Bob</code>のデータを一度に追加することができます。
    実行されるクエリは以下のようになります。</p>
    <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">INSERT</span><span> </span><span class="keyword">INTO</span><span> </span><span class="identifier">users</span><span> (</span><span class="identifier">name</span><span>, </span><span class="identifier">age</span><span>) </span><span class="keyword">VALUES</span><span> (</span><span class="string-literal">&#39;Alice&#39;</span><span>, </span><span class="number-literal">20</span><span>);</span><span class="keyword">INSERT</span><span> </span><span class="keyword">INTO</span><span> </span><span class="identifier">users</span><span> (</span><span class="identifier">name</span><span>, </span><span class="identifier">age</span><span>) </span><span class="keyword">VALUES</span><span> (</span><span class="string-literal">&#39;Bob&#39;</span><span>, </span><span class="number-literal">30</span><span>);</span></code></pre>
    <p>バッチコマンド実行後の戻り値は、実行したクエリそれぞれの影響を受けた行数の配列となります。</p>
    <p>上記の例では、<code>Alice</code>のデータは1行追加され、<code>Bob</code>のデータも1行追加されるため、戻り値は<code>List(1, 1)</code>となります。</p>
    <p>バッチコマンドを実行した後は、今まで<code>addBatch</code>メソッドで追加したクエリがクリアされます。</p>
    <p>手動でクリアする場合は<code>clearBatch</code>メソッドを使用してクリアを行います。</p>
    <pre class="keep-together pdf epub"><code class="nohighlight"><span class="identifier">connection</span><span>.</span><span class="identifier">use</span><span> { </span><span class="identifier">conn</span><span> =&gt;
  </span><span class="keyword">for</span><span>
    </span><span class="identifier">statement</span><span> &lt;- </span><span class="identifier">conn</span><span>.</span><span class="identifier">createStatement</span><span>()
    </span><span class="identifier">_</span><span> &lt;- </span><span class="identifier">statement</span><span>.</span><span class="identifier">addBatch</span><span>(</span><span class="string-literal">&quot;INSERT INTO users (name, age) VALUES (&#39;Alice&#39;, 20)&quot;</span><span>)
    </span><span class="identifier">_</span><span> &lt;- </span><span class="identifier">statement</span><span>.</span><span class="identifier">clearBatch</span><span>()
    </span><span class="identifier">_</span><span> &lt;- </span><span class="identifier">statement</span><span>.</span><span class="identifier">addBatch</span><span>(</span><span class="string-literal">&quot;INSERT INTO users (name, age) VALUES (&#39;Bob&#39;, 30)&quot;</span><span>)
    </span><span class="identifier">_</span><span> &lt;- </span><span class="identifier">statement</span><span>.</span><span class="identifier">executeBatch</span><span>()
  </span><span class="keyword">yield</span><span>
}</span></code></pre>
    <p>上記の例では、<code>Alice</code>のデータは追加されませんが、<code>Bob</code>のデータは追加されます。</p>
    
    <h3 id="statementとpreparedstatementの違い" class="section"><a class="anchor-link left" href="#statementとpreparedstatementの違い"><i class="icofont-laika link">&#xef71;</i></a>StatementとPreparedStatementの違い</h3>
    <p><code>Statement</code>と<code>PreparedStatement</code>ではバッチコマンドで実行されるクエリが異なる場合があります。</p>
    <p><code>Statement</code>を使用してINSERT文をバッチコマンドで実行した場合、複数のクエリが一度に実行されます。
    しかし、<code>PreparedStatement</code>を使用してINSERT文をバッチコマンドで実行した場合、1つのクエリが実行されます。</p>
    <p>例えば、以下のクエリをバッチコマンドで実行した場合、<code>Statement</code>を使用しているため、複数のクエリが一度に実行されます。</p>
    <pre class="keep-together pdf epub"><code class="nohighlight"><span class="identifier">connection</span><span>.</span><span class="identifier">use</span><span> { </span><span class="identifier">conn</span><span> =&gt;
  </span><span class="keyword">for</span><span>
    </span><span class="identifier">statement</span><span> &lt;- </span><span class="identifier">conn</span><span>.</span><span class="identifier">createStatement</span><span>()
    </span><span class="identifier">_</span><span> &lt;- </span><span class="identifier">statement</span><span>.</span><span class="identifier">addBatch</span><span>(</span><span class="string-literal">&quot;INSERT INTO users (name, age) VALUES (&#39;Alice&#39;, 20)&quot;</span><span>)
    </span><span class="identifier">_</span><span> &lt;- </span><span class="identifier">statement</span><span>.</span><span class="identifier">addBatch</span><span>(</span><span class="string-literal">&quot;INSERT INTO users (name, age) VALUES (&#39;Bob&#39;, 30)&quot;</span><span>)
    </span><span class="identifier">result</span><span> &lt;- </span><span class="identifier">statement</span><span>.</span><span class="identifier">executeBatch</span><span>()
  </span><span class="keyword">yield</span><span> </span><span class="identifier">result</span><span>
}

</span><span class="comment">// 実行されるクエリ
// INSERT INTO users (name, age) VALUES (&#39;Alice&#39;, 20);INSERT INTO users (name, age) VALUES (&#39;Bob&#39;, 30);</span></code></pre>
    <p>しかし、以下のクエリをバッチコマンドで実行した場合、<code>PreparedStatement</code>を使用しているため、1つのクエリが実行されます。</p>
    <pre><code class="nohighlight"><span class="identifier">connection</span><span>.</span><span class="identifier">use</span><span> { </span><span class="identifier">conn</span><span> =&gt;
  </span><span class="keyword">for</span><span>
    </span><span class="identifier">statement</span><span> &lt;- </span><span class="identifier">conn</span><span>.</span><span class="identifier">clientPreparedStatement</span><span>(</span><span class="string-literal">&quot;INSERT INTO users (name, age) VALUES (?, ?)&quot;</span><span>)
    </span><span class="identifier">_</span><span> &lt;- </span><span class="identifier">statement</span><span>.</span><span class="identifier">setString</span><span>(</span><span class="number-literal">1</span><span>, </span><span class="string-literal">&quot;Alice&quot;</span><span>)
    </span><span class="identifier">_</span><span> &lt;- </span><span class="identifier">statement</span><span>.</span><span class="identifier">setInt</span><span>(</span><span class="number-literal">2</span><span>, </span><span class="number-literal">20</span><span>)
    </span><span class="identifier">_</span><span> &lt;- </span><span class="identifier">statement</span><span>.</span><span class="identifier">addBatch</span><span>()
    </span><span class="identifier">_</span><span> &lt;- </span><span class="identifier">statement</span><span>.</span><span class="identifier">setString</span><span>(</span><span class="number-literal">1</span><span>, </span><span class="string-literal">&quot;Bob&quot;</span><span>)
    </span><span class="identifier">_</span><span> &lt;- </span><span class="identifier">statement</span><span>.</span><span class="identifier">setInt</span><span>(</span><span class="number-literal">2</span><span>, </span><span class="number-literal">30</span><span>)
    </span><span class="identifier">_</span><span> &lt;- </span><span class="identifier">statement</span><span>.</span><span class="identifier">addBatch</span><span>()
    </span><span class="identifier">result</span><span> &lt;- </span><span class="identifier">statement</span><span>.</span><span class="identifier">executeBatch</span><span>()
  </span><span class="keyword">yield</span><span> </span><span class="identifier">result</span><span>
}

</span><span class="comment">// 実行されるクエリ
// INSERT INTO users (name, age) VALUES (&#39;Alice&#39;, 20), (&#39;Bob&#39;, 30);</span></code></pre>
    <p>これは、<code>PreparedStatement</code>を使用している場合、クエリのパラメーターを設定した後に<code>addBatch</code>メソッドを使用することで、1つのクエリに複数のパラメーターを設定することができるためです。</p>
    
    <h2 id="ストアドプロシージャの実行" class="section"><a class="anchor-link left" href="#ストアドプロシージャの実行"><i class="icofont-laika link">&#xef71;</i></a>ストアドプロシージャの実行</h2>
    <p>ldbcではストアドプロシージャを実行するためのAPIを提供しています。</p>
    <p>ストアドプロシージャを実行するには<code>Connection</code>の<code>prepareCall</code>メソッドを使用して<code>CallableStatement</code>を構築します。</p>
    <p>※ 使用するストアドプロシージャは<a href="https://dev.mysql.com/doc/connector-j/en/connector-j-usagenotes-statements-callable.html">公式</a>ドキュメント記載のものを使用しています。</p>
    <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">CREATE</span><span> </span><span class="keyword">PROCEDURE</span><span> </span><span class="identifier">demoSp</span><span>(</span><span class="keyword">IN</span><span> </span><span class="identifier">inputParam</span><span> </span><span class="type-name">VARCHAR</span><span>(</span><span class="number-literal">255</span><span>), </span><span class="identifier">INOUT</span><span> </span><span class="identifier">inOutParam</span><span> </span><span class="type-name">INT</span><span>)
</span><span class="keyword">BEGIN</span><span>
    </span><span class="keyword">DECLARE</span><span> </span><span class="identifier">z</span><span> </span><span class="type-name">INT</span><span>;
    </span><span class="keyword">SET</span><span> </span><span class="identifier">z</span><span> = </span><span class="identifier">inOutParam</span><span> + </span><span class="number-literal">1</span><span>;
    </span><span class="keyword">SET</span><span> </span><span class="identifier">inOutParam</span><span> = </span><span class="identifier">z</span><span>;

    </span><span class="keyword">SELECT</span><span> </span><span class="identifier">inputParam</span><span>;

    </span><span class="keyword">SELECT</span><span> </span><span class="identifier">CONCAT</span><span>(</span><span class="string-literal">&#39;zyxw&#39;</span><span>, </span><span class="identifier">inputParam</span><span>);
</span><span class="keyword">END</span></code></pre>
    <p>上記のストアドプロシージャを実行する場合は以下のようになります。</p>
    <pre><code class="nohighlight"><span class="identifier">connection</span><span>.</span><span class="identifier">use</span><span> { </span><span class="identifier">conn</span><span> =&gt;
  </span><span class="keyword">for</span><span>
    </span><span class="identifier">callableStatement</span><span> &lt;- </span><span class="identifier">conn</span><span>.</span><span class="identifier">prepareCall</span><span>(</span><span class="string-literal">&quot;CALL demoSp(?, ?)&quot;</span><span>)
    </span><span class="identifier">_</span><span> &lt;- </span><span class="identifier">callableStatement</span><span>.</span><span class="identifier">setString</span><span>(</span><span class="number-literal">1</span><span>, </span><span class="string-literal">&quot;abcdefg&quot;</span><span>)
    </span><span class="identifier">_</span><span> &lt;- </span><span class="identifier">callableStatement</span><span>.</span><span class="identifier">setInt</span><span>(</span><span class="number-literal">2</span><span>, </span><span class="number-literal">1</span><span>)
    </span><span class="identifier">hasResult</span><span> &lt;- </span><span class="identifier">callableStatement</span><span>.</span><span class="identifier">execute</span><span>()
    </span><span class="identifier">values</span><span> &lt;- </span><span class="type-name">Monad</span><span>[</span><span class="type-name">IO</span><span>].</span><span class="identifier">whileM</span><span>[</span><span class="type-name">List</span><span>, </span><span class="type-name">Option</span><span>[</span><span class="type-name">String</span><span>]](</span><span class="identifier">callableStatement</span><span>.</span><span class="identifier">getMoreResults</span><span>()) {
      </span><span class="keyword">for</span><span>
        </span><span class="identifier">resultSet</span><span> &lt;- </span><span class="identifier">callableStatement</span><span>.</span><span class="identifier">getResultSet</span><span>().</span><span class="identifier">flatMap</span><span> {
          </span><span class="keyword">case</span><span> </span><span class="type-name">Some</span><span>(</span><span class="identifier">rs</span><span>) =&gt; </span><span class="type-name">IO</span><span>.</span><span class="identifier">pure</span><span>(</span><span class="identifier">rs</span><span>)
          </span><span class="keyword">case</span><span> </span><span class="type-name">None</span><span>     =&gt; </span><span class="type-name">IO</span><span>.</span><span class="identifier">raiseError</span><span>(</span><span class="keyword">new</span><span> </span><span class="type-name">Exception</span><span>(</span><span class="string-literal">&quot;No result set&quot;</span><span>))
        }
        </span><span class="identifier">value</span><span> &lt;- </span><span class="identifier">resultSet</span><span>.</span><span class="identifier">getString</span><span>(</span><span class="number-literal">1</span><span>)
      </span><span class="keyword">yield</span><span> </span><span class="identifier">value</span><span>
    }
  </span><span class="keyword">yield</span><span> </span><span class="identifier">values</span><span> </span><span class="comment">// List(Some(&quot;abcdefg&quot;), Some(&quot;zyxwabcdefg&quot;))
</span><span>}</span></code></pre>
    <p>出力パラメータ（ストアド・プロシージャを作成したときにOUTまたはINOUTとして指定したパラメータ）の値を取得するには、JDBCでは、CallableStatementインターフェイスのさまざまな<code>registerOutputParameter()</code>メソッドを使用して、ステートメント実行前にパラメータを指定する必要がありますが、ldbcでは<code>setXXX</code>メソッドを使用してパラメータを設定することだけクエリ実行時にパラメーターの設定も行なってくれます。</p>
    <p>ただし、ldbcでも<code>registerOutputParameter()</code>メソッドを使用してパラメータを指定することもできます。</p>
    <pre class="keep-together pdf epub"><code class="nohighlight"><span class="identifier">connection</span><span>.</span><span class="identifier">use</span><span> { </span><span class="identifier">conn</span><span> =&gt;
  </span><span class="keyword">for</span><span>
    </span><span class="identifier">callableStatement</span><span> &lt;- </span><span class="identifier">conn</span><span>.</span><span class="identifier">prepareCall</span><span>(</span><span class="string-literal">&quot;CALL demoSp(?, ?)&quot;</span><span>)
    </span><span class="identifier">_</span><span> &lt;- </span><span class="identifier">callableStatement</span><span>.</span><span class="identifier">setString</span><span>(</span><span class="number-literal">1</span><span>, </span><span class="string-literal">&quot;abcdefg&quot;</span><span>)
    </span><span class="identifier">_</span><span> &lt;- </span><span class="identifier">callableStatement</span><span>.</span><span class="identifier">setInt</span><span>(</span><span class="number-literal">2</span><span>, </span><span class="number-literal">1</span><span>)
    </span><span class="identifier">_</span><span> &lt;- </span><span class="identifier">callableStatement</span><span>.</span><span class="identifier">registerOutParameter</span><span>(</span><span class="number-literal">2</span><span>, </span><span class="identifier">ldbc</span><span>.</span><span class="identifier">connector</span><span>.</span><span class="identifier">data</span><span>.</span><span class="type-name">Types</span><span>.</span><span class="type-name">INTEGER</span><span>)
    </span><span class="identifier">hasResult</span><span> &lt;- </span><span class="identifier">callableStatement</span><span>.</span><span class="identifier">execute</span><span>()
    </span><span class="identifier">value</span><span> &lt;- </span><span class="identifier">callableStatement</span><span>.</span><span class="identifier">getInt</span><span>(</span><span class="number-literal">2</span><span>)
  </span><span class="keyword">yield</span><span> </span><span class="identifier">value</span><span> </span><span class="comment">// 2
</span><span>}</span></code></pre>
    <p>※ <code>registerOutParameter</code>でOutパラメータを指定する場合、同じindex値を使用して<code>setXXX</code>メソッドでパラメータを設定していない場合サーバーには<code>Null</code>で値が設定されることに注意してください。</p>
    
    <h2 id="未対応機能" class="section"><a class="anchor-link left" href="#未対応機能"><i class="icofont-laika link">&#xef71;</i></a>未対応機能</h2>
    <p>ldbcコネクタは現在実験的な機能となります。そのため、以下の機能はサポートされていません。
    機能提供は順次行っていく予定です。</p>
    <ul>
      <li>コネクションプーリング</li>
      <li>フェイルオーバー対策</li>
      <li>etc...</li>
    </ul>

    
<hr class="footer-rule"/>
<footer>
  ldbc is a <a href="https://typelevel.org/">Typelevel</a> project distributed under the <a href="https://img.shields.io/badge/license-MIT-green">MIT</a> license.
</footer>


  </main>

</div>

</body>

</html>
