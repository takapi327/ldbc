<!DOCTYPE html>
<html class="no-js" lang="en">

<head>
<title>テーブル定義 · LDBC</title>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="description" content='Documentation for ldbc'/>
<link rel="canonical" href="https://takapi327.github.io/ldbc/../ja/01-Table-Definitions.html"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:100normal,100italic,300normal,300italic,400normal,400italic,500normal,500italic,700normal,700italic,900normal,900italicc" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../lib/jquery/jquery.min.js"></script>
<script type="text/javascript" src="../js/page.js"></script>
<script type="text/javascript" src="../js/warnOldVersion.js"></script>
<script type="text/javascript" src="../js/groups.js"></script>
<script type="text/javascript" src="../js/snippets.js"></script>
<link rel="stylesheet" type="text/css" href="../lib/foundation/dist/foundation.min.css"/>
<link rel="stylesheet" type="text/css" href="../css/page.css"/>

<!--
<link rel="shortcut icon" href="../images/favicon.ico" />
-->
</head>

<body>
<div class="off-canvas-wrapper">
<div class="off-canvas-wrapper-inner" data-off-canvas-wrapper>

<div class="off-canvas position-left" id="off-canvas-menu" data-off-canvas>
<nav class="off-canvas-nav">
<div class="nav-home">
<a href="../ja/index.html" >
<span class="home-icon">⌂</span>LDBC
</a>
<div class="version-number">
0.2.1
</div>
</div>
<div class="nav-toc">
<ul>
  <li><a href="../ja/01-Table-Definitions.html" class="active page">テーブル定義</a></li>
  <li><a href="../ja/02-Custom-Data-Type.html" class="page">カスタム データ型</a></li>
  <li><a href="../ja/03-Type-safe-Query-Builder.html" class="page">型安全なクエリ構築</a></li>
  <li><a href="../ja/04-Database-Connection.html" class="page">データベース接続</a></li>
  <li><a href="../ja/05-Plain-SQL-Queries.html" class="page">プレーンなSQLクエリ</a></li>
  <li><a href="../ja/06-Generating-SchemaSPY-Documentation.html" class="page">SchemaSPYドキュメントの生成</a></li>
  <li><a href="../ja/07-Schema-Code-Generation.html" class="page">スキーマコード生成</a></li>
  <li><a href="../ja/08-Perdormance.html" class="page">パフォーマンス</a></li>
</ul>
</div>

</nav>
</div>

<div class="off-canvas-content" data-off-canvas-content>

<header class="site-header expanded row">
<div class="small-12 column">
<a href="#" class="off-canvas-toggle hide-for-medium" data-toggle="off-canvas-menu"><svg class="svg-icon svg-icon-menu" version="1.1" id="Menu" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve"> <path class="svg-icon-menu-path" fill="#53CDEC" d="M16.4,9H3.6C3.048,9,3,9.447,3,10c0,0.553,0.048,1,0.6,1H16.4c0.552,0,0.6-0.447,0.6-1C17,9.447,16.952,9,16.4,9z M16.4,13
H3.6C3.048,13,3,13.447,3,14c0,0.553,0.048,1,0.6,1H16.4c0.552,0,0.6-0.447,0.6-1C17,13.447,16.952,13,16.4,13z M3.6,7H16.4
C16.952,7,17,6.553,17,6c0-0.553-0.048-1-0.6-1H3.6C3.048,5,3,5.447,3,6C3,6.553,3.048,7,3.6,7z"/></svg>
</a>
<div class="title"><a href="../ja/index.html">LDBC</a></div>

<!--
<a href="https://www.example.com" class="logo show-for-medium">logo</a>
-->
</div>
</header>

<div class="expanded row">

<div class="medium-3 large-2 show-for-medium column">
<nav class="site-nav">
<div class="nav-home">
<a href="../ja/index.html" >
<span class="home-icon">⌂</span>LDBC
</a>
<div class="version-number">
0.2.1
</div>
</div>
<div class="nav-toc">
<ul>
  <li><a href="../ja/01-Table-Definitions.html" class="active page">テーブル定義</a></li>
  <li><a href="../ja/02-Custom-Data-Type.html" class="page">カスタム データ型</a></li>
  <li><a href="../ja/03-Type-safe-Query-Builder.html" class="page">型安全なクエリ構築</a></li>
  <li><a href="../ja/04-Database-Connection.html" class="page">データベース接続</a></li>
  <li><a href="../ja/05-Plain-SQL-Queries.html" class="page">プレーンなSQLクエリ</a></li>
  <li><a href="../ja/06-Generating-SchemaSPY-Documentation.html" class="page">SchemaSPYドキュメントの生成</a></li>
  <li><a href="../ja/07-Schema-Code-Generation.html" class="page">スキーマコード生成</a></li>
  <li><a href="../ja/08-Perdormance.html" class="page">パフォーマンス</a></li>
</ul>
</div>

</nav>
</div>

<div class="small-12 medium-9 large-10 column">
<section class="site-content">

<span id="version-warning"></span>

<div class="page-header row">
<div class="medium-12 show-for-medium column">
<div class="nav-breadcrumbs">
<ul>
  <li><a href="../ja/index.html">LDBC</a></li>
  <li>テーブル定義</li>
</ul>
</div>
</div>
</div>

<div class="page-content row">
<div class="small-12 large-9 column" id="docs">
<h1><a href="#テーブル定義" name="テーブル定義" class="anchor"><span class="anchor-link"></span></a>テーブル定義</h1>
<p>この章では、Scala コードでデータベーススキーマを扱う方法、特に既存のデータベースなしでアプリケーションを書き始めるときに便利な、手動でスキーマを記述する方法について説明します。すでにデータベースにスキーマがある場合は、<a href="/ldbc/ja/07-Schema-Code-Generation.html">code generator</a> を使ってこの作業を省略することもできます。</p>
<p>以下のコード例では、以下のimportを想定しています。</p>
<pre class="prettyprint"><code class="language-scala 3">import ldbc.core.*
import ldbc.core.attribute.*
</code></pre>
<p>LDBCは、Scalaモデルとデータベースのテーブル定義を1対1のマッピングで管理します。モデルが保持するプロパティとテーブルが保持するカラムのマッピングは、定義順に行われます。テーブル定義は、Create文の構造と非常によく似ています。このため、テーブル定義の構築はユーザーにとって直感的なものとなります。</p>
<p>LDBC は、このテーブル定義をさまざまな目的で使用します。型安全なクエリの生成、ドキュメントの生成など。</p>
<pre class="prettyprint"><code class="language-scala 3">case class User(
  id: Long,
  name: String,
  age: Option[Int],
)

val table = Table[User](&quot;user&quot;)(                     // CREATE TABLE `user` (
  column(&quot;id&quot;, BIGINT, AUTO_INCREMENT, PRIMARY_KEY), //   `id` BIGINT NOT NULL AUTO_INCREMENT PRIMARY KEY,
  column(&quot;name&quot;, VARCHAR(255)),                      //   `name` VARCHAR(255) NOT NULL,
  column(&quot;age&quot;, INT.UNSIGNED.DEFAULT(None)),         //   `age` INT unsigned DEFAULT NULL
)                                                    // );
</code></pre>
<p>すべてのカラムはcolumnメソッドで定義されます。各カラムにはカラム名、データ型、属性があります。以下のプリミティブ型が標準でサポートされており、すぐに使用できます。</p>
<ul>
  <li>Numeric types: <code>Byte</code>, <code>Short</code>, <code>Int</code>, <code>Long</code>, <code>Float</code>, <code>Double</code>, <code>BigDecimal</code>, <code>BigInt</code></li>
  <li>LOB types: <code>java.sql.Blob</code>, <code>java.sql.Clob</code>, <code>Array[Byte]</code></li>
  <li>Date types: <code>java.sql.Date</code>, <code>java.sql.Time</code>, <code>java.sql.Timestamp</code></li>
  <li>String</li>
  <li>Boolean</li>
  <li>java.time.*</li>
</ul>
<p>Null可能な列はOption[T]で表現され、Tはサポートされるプリミティブ型の1つです。Option型でない列はすべてNot Nullであることに注意してください。</p>
<h2><a href="#データ型" name="データ型" class="anchor"><span class="anchor-link"></span></a>データ型</h2>
<p>モデルが持つプロパティのScala型とカラムが持つデータ型の対応付けは、定義されたデータ型がScala型をサポートしている必要があります。サポートされていない型を割り当てようとするとコンパイルエラーが発生します。</p>
<p>データ型がサポートするScalaの型は以下の表の通りです。</p>
<table>
  <thead>
    <tr>
      <th>Data Type </th>
      <th>Scala Type </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>BIT </td>
      <td>Byte, Short, Int, Long </td>
    </tr>
    <tr>
      <td>TINYINT </td>
      <td>Byte, Short </td>
    </tr>
    <tr>
      <td>SMALLINT </td>
      <td>Short, Int </td>
    </tr>
    <tr>
      <td>MEDIUMINT </td>
      <td>Int </td>
    </tr>
    <tr>
      <td>INT </td>
      <td>Int, Long </td>
    </tr>
    <tr>
      <td>BIGINT </td>
      <td>Long, BigInt </td>
    </tr>
    <tr>
      <td>DECIMAL </td>
      <td>BigDecimal </td>
    </tr>
    <tr>
      <td>FLOAT </td>
      <td>Float </td>
    </tr>
    <tr>
      <td>DOUBLE </td>
      <td>Double </td>
    </tr>
    <tr>
      <td>CHAR </td>
      <td>String </td>
    </tr>
    <tr>
      <td>VARCHAR </td>
      <td>String </td>
    </tr>
    <tr>
      <td>BINARY </td>
      <td>Array[Byte] </td>
    </tr>
    <tr>
      <td>VARBINARY </td>
      <td>Array[Byte] </td>
    </tr>
    <tr>
      <td>TINYBLOB </td>
      <td>Array[Byte] </td>
    </tr>
    <tr>
      <td>BLOB </td>
      <td>Array[Byte] </td>
    </tr>
    <tr>
      <td>MEDIUMBLOB </td>
      <td>Array[Byte] </td>
    </tr>
    <tr>
      <td>LONGBLOB </td>
      <td>Array[Byte] </td>
    </tr>
    <tr>
      <td>TINYTEXT </td>
      <td>String </td>
    </tr>
    <tr>
      <td>TEXT </td>
      <td>String </td>
    </tr>
    <tr>
      <td>MEDIUMTEXT </td>
      <td>String </td>
    </tr>
    <tr>
      <td>DATE </td>
      <td>java.time.LocalDate </td>
    </tr>
    <tr>
      <td>DATETIME </td>
      <td>java.time.Instant, java.time.LocalDateTime, java.time.OffsetTime </td>
    </tr>
    <tr>
      <td>TIMESTAMP </td>
      <td>java.time.Instant, java.time.LocalDateTime, java.time.OffsetDateTime, java.time.ZonedDateTime </td>
    </tr>
    <tr>
      <td>TIME </td>
      <td>java.time.LocalTime </td>
    </tr>
    <tr>
      <td>YEAR </td>
      <td>java.time.Instant, java.time.LocalDate, java.time.Year </td>
    </tr>
    <tr>
      <td>BOOLEAN </td>
      <td>Boolean </td>
    </tr>
  </tbody>
</table>
<p><strong>整数型を扱う際の注意点</strong></p>
<p>符号あり、符号なしに応じて、扱えるデータの範囲がScalaの型に収まらないことに注意する必要があります。</p>
<table>
  <thead>
    <tr>
      <th>Data Type </th>
      <th>signed range </th>
      <th>unsigned range </th>
      <th>Scala Type </th>
      <th>range </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>TINYINT </td>
      <td>-128 ~ 127 </td>
      <td>0 ~ 255 </td>
      <td>Byte<br>Short </td>
      <td>-128 ~ 127<br>-32768～32767 </td>
    </tr>
    <tr>
      <td>SMALLINT </td>
      <td>-32768 ~ 32767 </td>
      <td>0 ~ 65535 </td>
      <td>Short<br>Int </td>
      <td>-32768～32767<br>-2147483648～2147483647 </td>
    </tr>
    <tr>
      <td>MEDIUMINT </td>
      <td>-8388608 ~ 8388607 </td>
      <td>0 ~ 16777215 </td>
      <td>Int </td>
      <td>-2147483648～2147483647 </td>
    </tr>
    <tr>
      <td>INT </td>
      <td>-2147483648	~ 2147483647 </td>
      <td>0 ~ 4294967295 </td>
      <td>Int<br>Long </td>
      <td>-2147483648～2147483647<br>-9223372036854775808～9223372036854775807 </td>
    </tr>
    <tr>
      <td>BIGINT </td>
      <td>-9223372036854775808 ~ 9223372036854775807 </td>
      <td>0 ~ 18446744073709551615 </td>
      <td>Long<br>BigInt </td>
      <td>-9223372036854775808～9223372036854775807<br>&hellip; </td>
    </tr>
  </tbody>
</table>
<p>ユーザー定義の独自型やサポートされていない型を扱う場合は、<a href="/ldbc/ja/02-Custom-Data-Type.html">カスタム型</a> を参照してください。</p>
<h2><a href="#属性" name="属性" class="anchor"><span class="anchor-link"></span></a>属性</h2>
<p>カラムにはさまざまな属性を割り当てることができます。</p>
<ul>
  <li><code>AUTO_INCREMENT</code>  DDL文を作成し、SchemaSPYを文書化する際に、列を自動インクリメント・キーとしてマークする。  MySQLでは、データ挿入時にAutoIncでないカラムを返すことはできません。そのため、必要に応じて、LDBCは戻りカラムがAutoIncとして適切にマークされているかどうかを確認します。</li>
  <li><code>PRIMARY_KEY</code>  DDL文やSchemaSPYドキュメントを作成する際に、列を主キーとしてマークする。</li>
  <li><code>UNIQUE_KEY</code>  DDL文やSchemaSPYドキュメントを作成する際に、列を一意キーとしてマークする。</li>
  <li><code>COMMENT</code>  DDL文やSchemaSPY文書を作成する際に、列にコメントを設定する。</li>
</ul>
<h2><a href="#キーの設定" name="キーの設定" class="anchor"><span class="anchor-link"></span></a>キーの設定</h2>
<p>MySQLではテーブルに対してUniqueキーやIndexキー、外部キーなどの様々なキーを設定することができます。LDBCで構築したテーブル定義でこれらのキーを設定する方法を見ていきましょう。</p>
<h3><a href="#primary-key" name="primary-key" class="anchor"><span class="anchor-link"></span></a>PRIMARY KEY</h3>
<p>主キー（primary key）とはMySQLにおいてデータを一意に識別するための項目のことです。カラムにプライマリーキー制約を設定すると、カラムには他のデータの値を重複することのない値しか格納することができなくなります。また NULL も格納することができません。その結果、プライマリーキー制約が設定されたカラムの値を検索することで、テーブルの中でただ一つのデータを特定することができます。</p>
<p>LDBCではこのプライマリーキー制約を2つの方法で設定することができます。</p>
<ol>
  <li>columnメソッドの属性として設定する</li>
  <li>tableのkeySetメソッドで設定する</li>
</ol>
<p><strong>columnメソッドの属性として設定する</strong></p>
<p>columnメソッドの属性として設定する方法は非常に簡単で、columnメソッドの第3引数以降に<code>PRIMARY_KEY</code>を渡すだけです。これによって以下の場合 <code>id</code>カラムを主キーとして設定することができます。</p>
<pre class="prettyprint"><code class="language-scala 3">column(&quot;id&quot;, BIGINT, AUTO_INCREMENT, PRIMARY_KEY)
</code></pre>
<p><strong>tableのkeySetメソッドで設定する</strong></p>
<p>LDBCのテーブル定義には <code>keySet</code>というメソッドが生えており、ここで<code>PRIMARY_KEY</code>に主キーとして設定したいカラムを渡すことで主キーとして設定することができます。</p>
<pre class="prettyprint"><code class="language-scala 3">val table = Table[User](&quot;user&quot;)(
  column(&quot;id&quot;, BIGINT[Long], AUTO_INCREMENT),
  column(&quot;name&quot;, VARCHAR(255)),
  column(&quot;age&quot;, INT.UNSIGNED.DEFAULT(None))
)
  .keySet(table =&gt; PRIMARY_KEY(table.id))

// CREATE TABLE `user` (
//   ...,
//   PRIMARY KEY (`id`)
// )
</code></pre>
<p><code>PRIMARY_KEY</code>メソッドにはカラム意外にも以下のパラメーターを設定することができます。</p>
<ul>
  <li><code>Index Type</code> ldbc.core.Index.Type.BTREE or ldbc.core.Index.Type.HASH</li>
  <li><code>Index Option</code> ldbc.core.Index.IndexOption</li>
</ul>
<h4><a href="#複合キー-primary-key-" name="複合キー-primary-key-" class="anchor"><span class="anchor-link"></span></a>複合キー (primary key)</h4>
<p>1つのカラムだけではなく、複数のカラムを主キーとして組み合わせ主キーとして設定することもできます。<code>PRIMARY_KEY</code>に主キーとして設定したいカラムを複数渡すだけで複合主キーとして設定することができます。</p>
<pre class="prettyprint"><code class="language-scala 3">val table = Table[User](&quot;user&quot;)(
  column(&quot;id&quot;, BIGINT[Long], AUTO_INCREMENT),
  column(&quot;name&quot;, VARCHAR(255)),
  column(&quot;age&quot;, INT.UNSIGNED.DEFAULT(None))
)
  .keySet(table =&gt; PRIMARY_KEY(table.id, table.name))

// CREATE TABLE `user` (
//   ...,
//   PRIMARY KEY (`id`, `name`)
// )
</code></pre>
<p>複合キーは<code>keySet</code>メソッドでの<code>PRIMARY_KEY</code>でしか設定することはできません。仮に以下のようにcolumnメソッドの属性として複数設定を行うと複合キーとしてではなく、それぞれを主キーとして設定されてしまいます。</p>
<p>LDBCではテーブル定義に複数<code>PRIMARY_KEY</code>を設定したとしてもコンパイルエラーにすることはできません。しかし、テーブル定義をクエリの生成やドキュメントの生成などで使用する場合エラーとなります。これはPRIMARY KEYはテーブルごとに1つしか設定することができないという制約によるものです。</p>
<pre class="prettyprint"><code class="language-scala 3">val table = Table[User](&quot;user&quot;)(
  column(&quot;id&quot;, BIGINT[Long], AUTO_INCREMENT, PRIMARY_KEY),
  column(&quot;name&quot;, VARCHAR(255), PRIMARY_KEY),
  column(&quot;age&quot;, INT.UNSIGNED.DEFAULT(None))
)

// CREATE TABLE `user` (
//   `id` BIGINT AUTO_INCREMENT PRIMARY KEY,
// )
</code></pre>
<h3><a href="#unique-key" name="unique-key" class="anchor"><span class="anchor-link"></span></a>UNIQUE KEY</h3>
<p>一意キー（unique key）とはMySQLにおいてデータを一意に識別するための項目のことです。カラムに一意性制約を設定すると、カラムには他のデータの値を重複することのない値しか格納することができなくなります。</p>
<p>LDBCではこの一意性制約を2つの方法で設定することができます。</p>
<ol>
  <li>columnメソッドの属性として設定する</li>
  <li>tableのkeySetメソッドで設定する</li>
</ol>
<p><strong>columnメソッドの属性として設定する</strong></p>
<p>columnメソッドの属性として設定する方法は非常に簡単で、columnメソッドの第3引数以降に<code>UNIQUE_KEY</code>を渡すだけです。これによって以下の場合 <code>id</code>カラムを一意キーとして設定することができます。</p>
<pre class="prettyprint"><code class="language-scala 3">column(&quot;id&quot;, BIGINT, AUTO_INCREMENT, UNIQUE_KEY)
</code></pre>
<p><strong>tableのkeySetメソッドで設定する</strong></p>
<p>LDBCのテーブル定義には <code>keySet</code>というメソッドが生えており、ここで<code>UNIQUE_KEY</code>に一意キーとして設定したいカラムを渡すことで一意キーとして設定することができます。</p>
<pre class="prettyprint"><code class="language-scala 3">val table = Table[User](&quot;user&quot;)(
  column(&quot;id&quot;, BIGINT[Long], AUTO_INCREMENT),
  column(&quot;name&quot;, VARCHAR(255)),
  column(&quot;age&quot;, INT.UNSIGNED.DEFAULT(None))
)
  .keySet(table =&gt; UNIQUE_KEY(table.id))

// CREATE TABLE `user` (
//   ...,
//   UNIQUE KEY (`id`)
// )
</code></pre>
<p><code>UNIQUE_KEY</code>メソッドにはカラム意外にも以下のパラメーターを設定することができます。</p>
<ul>
  <li><code>Index Name</code> String</li>
  <li><code>Index Type</code> ldbc.core.Index.Type.BTREE or ldbc.core.Index.Type.HASH</li>
  <li><code>Index Option</code> ldbc.core.Index.IndexOption</li>
</ul>
<h4><a href="#複合キー-unique-key-" name="複合キー-unique-key-" class="anchor"><span class="anchor-link"></span></a>複合キー (unique key)</h4>
<p>1つのカラムだけではなく、複数のカラムを一意キーとして組み合わせ一意キーとして設定することもできます。<code>UNIQUE_KEY</code>に一意キーとして設定したいカラムを複数渡すだけで複合一意キーとして設定することができます。</p>
<pre class="prettyprint"><code class="language-scala 3">val table = Table[User](&quot;user&quot;)(
  column(&quot;id&quot;, BIGINT[Long], AUTO_INCREMENT),
  column(&quot;name&quot;, VARCHAR(255)),
  column(&quot;age&quot;, INT.UNSIGNED.DEFAULT(None))
)
  .keySet(table =&gt; UNIQUE_KEY(table.id, table.name))

// CREATE TABLE `user` (
//   ...,
//   UNIQUE KEY (`id`, `name`)
// )
</code></pre>
<p>複合キーは<code>keySet</code>メソッドでの<code>UNIQUE_KEY</code>でしか設定することはできません。仮にcolumnメソッドの属性として複数設定を行うと複合キーとしてではなく、それぞれを一意キーとして設定されてしまいます。</p>
<h3><a href="#index-key" name="index-key" class="anchor"><span class="anchor-link"></span></a>INDEX KEY</h3>
<p>インデックスキー（index key）とはMySQLにおいて目的のレコードを効率よく取得するための「索引」のことです。</p>
<p>LDBCではこのインデックスを2つの方法で設定することができます。</p>
<ol>
  <li>columnメソッドの属性として設定する</li>
  <li>tableのkeySetメソッドで設定する</li>
</ol>
<p><strong>columnメソッドの属性として設定する</strong></p>
<p>columnメソッドの属性として設定する方法は非常に簡単で、columnメソッドの第3引数以降に<code>INDEX_KEY</code>を渡すだけです。これによって以下の場合 <code>id</code>カラムをインデックスとして設定することができます。</p>
<pre class="prettyprint"><code class="language-scala 3">column(&quot;id&quot;, BIGINT, AUTO_INCREMENT, INDEX_KEY)
</code></pre>
<p><strong>tableのkeySetメソッドで設定する</strong></p>
<p>LDBCのテーブル定義には <code>keySet</code>というメソッドが生えており、ここで<code>INDEX_KEY</code>にインデックスとして設定したいカラムを渡すことでインデックスキーとして設定することができます。</p>
<pre class="prettyprint"><code class="language-scala 3">val table = Table[User](&quot;user&quot;)(
  column(&quot;id&quot;, BIGINT[Long], AUTO_INCREMENT),
  column(&quot;name&quot;, VARCHAR(255)),
  column(&quot;age&quot;, INT.UNSIGNED.DEFAULT(None))
)
  .keySet(table =&gt; INDEX_KEY(table.id))

// CREATE TABLE `user` (
//   ...,
//   INDEX KEY (`id`)
// )
</code></pre>
<p><code>INDEX_KEY</code>メソッドにはカラム意外にも以下のパラメーターを設定することができます。</p>
<ul>
  <li><code>Index Name</code> String</li>
  <li><code>Index Type</code> ldbc.core.Index.Type.BTREE or ldbc.core.Index.Type.HASH</li>
  <li><code>Index Option</code> ldbc.core.Index.IndexOption</li>
</ul>
<h4><a href="#複合キー-index-key-" name="複合キー-index-key-" class="anchor"><span class="anchor-link"></span></a>複合キー (index key)</h4>
<p>1つのカラムだけではなく、複数のカラムをインデックスキーとして組み合わせインデックスキーとして設定することもできます。<code>INDEX_KEY</code>にインデックスキーとして設定したいカラムを複数渡すだけで複合インデックスとして設定することができます。</p>
<pre class="prettyprint"><code class="language-scala 3">val table = Table[User](&quot;user&quot;)(
  column(&quot;id&quot;, BIGINT[Long], AUTO_INCREMENT),
  column(&quot;name&quot;, VARCHAR(255)),
  column(&quot;age&quot;, INT.UNSIGNED.DEFAULT(None))
)
  .keySet(table =&gt; INDEX_KEY(table.id, table.name))

// CREATE TABLE `user` (
//   ...,
//   INDEX KEY (`id`, `name`)
// )
</code></pre>
<p>複合キーは<code>keySet</code>メソッドでの<code>INDEX_KEY</code>でしか設定することはできません。仮にcolumnメソッドの属性として複数設定を行うと複合インデックスとしてではなく、それぞれをインデックスキーとして設定されてしまいます。</p>
<h3><a href="#foreign-key" name="foreign-key" class="anchor"><span class="anchor-link"></span></a>FOREIGN KEY</h3>
<p>外部キー（foreign key）とは、MySQLにおいてデータの整合性を保つための制約（参照整合性制約）です。 外部キーに設定されているカラムには、参照先となるテーブルのカラム内に存在している値しか設定できません。</p>
<p>LDBCではこの外部キー制約をtableのkeySetメソッドを使用する方法で設定することができます。</p>
<pre class="prettyprint"><code class="language-scala 3">val post = Table[Post](&quot;post&quot;)(
  column(&quot;id&quot;, BIGINT[Long], AUTO_INCREMENT, PRIMARY_KEY),
  column(&quot;name&quot;, VARCHAR(255))
)

val user = Table[User](&quot;user&quot;)(
  column(&quot;id&quot;, BIGINT[Long], AUTO_INCREMENT),
  column(&quot;name&quot;, VARCHAR(255)),
  column(&quot;age&quot;, INT.UNSIGNED.DEFAULT(None)),
  column(&quot;post_id&quot;, BIGINT[Long])
)
  .keySet(table =&gt; FOREIGN_KEY(table.postId, REFERENCE(post, post.id)))

// CREATE TABLE `user` (
//   ...,
//   FOREIGN KEY (`post_id`)  REFERENCES `post` (`id`)
// )
</code></pre>
<p><code>FOREIGN_KEY</code>メソッドにはカラムとReference値意外にも以下のパラメーターを設定することができます。</p>
<ul>
  <li><code>Index Name</code> String</li>
</ul>
<p>外部キー制約には親テーブルの削除時と更新時の挙動を設定することができます。<code>REFERENCE</code>メソッドに<code>onDelete</code>と<code>onUpdate</code>メソッドが提供されているのでこちらを使用することでそれぞれ設定することができます。</p>
<p>設定することのできる値は<code>ldbc.core.Reference.ReferenceOption</code>から取得することができます。</p>
<pre class="prettyprint"><code class="language-scala 3">val user = Table[User](&quot;user&quot;)(
  column(&quot;id&quot;, BIGINT[Long], AUTO_INCREMENT),
  column(&quot;name&quot;, VARCHAR(255)),
  column(&quot;age&quot;, INT.UNSIGNED.DEFAULT(None)),
  column(&quot;post_id&quot;, BIGINT[Long])
)
  .keySet(table =&gt; FOREIGN_KEY(table.postId, REFERENCE(post, post.id).onDelete(Reference.ReferenceOption.RESTRICT)))

// CREATE TABLE `user` (
//   ...,
//   FOREIGN KEY (`post_id`)  REFERENCES `post` (`id`) ON DELETE RESTRICT
// )
</code></pre>
<p>設定することのできる値は以下になります。</p>
<ul>
  <li><code>RESTRICT</code>: 親テーブルに対する削除または更新操作を拒否します。</li>
  <li><code>CASCADE</code>: 親テーブルから行を削除または更新し、子テーブル内の一致する行を自動的に削除または更新します。</li>
  <li><code>SET_NULL</code>: 親テーブルから行を削除または更新し、子テーブルの外部キーカラムを NULL に設定します。</li>
  <li><code>NO_ACTION</code>: 標準 SQL のキーワード。 MySQLでは、RESTRICT と同等です。</li>
  <li><code>SET_DEFAULT</code>: このアクションは MySQL パーサーによって認識されますが、InnoDB と NDB はどちらも、ON DELETE SET DEFAULT または ON UPDATE SET DEFAULT 句を含むテーブル定義を拒否します。</li>
</ul>
<h4><a href="#複合キー-foreign-key-" name="複合キー-foreign-key-" class="anchor"><span class="anchor-link"></span></a>複合キー (foreign key)</h4>
<p>1つのカラムだけではなく、複数のカラムを外部キーとして組み合わせて設定することもできます。<code>FOREIGN_KEY</code>に外部キーとして設定したいカラムを複数渡すだけで複合外部キーとして設定することができます。</p>
<pre class="prettyprint"><code class="language-scala 3">val post = Table[Post](&quot;post&quot;)(
  column(&quot;id&quot;, BIGINT[Long], AUTO_INCREMENT, PRIMARY_KEY),
  column(&quot;name&quot;, VARCHAR(255)),
  column(&quot;category&quot;, SMALLINT[Short])
)

val user = Table[User](&quot;user&quot;)(
  column(&quot;id&quot;, BIGINT[Long], AUTO_INCREMENT),
  column(&quot;name&quot;, VARCHAR(255)),
  column(&quot;age&quot;, INT.UNSIGNED.DEFAULT(None)),
  column(&quot;post_id&quot;, BIGINT[Long]),
  column(&quot;post_category&quot;, SMALLINT[Short])
)
  .keySet(table =&gt; FOREIGN_KEY((table.postId, table.postCategory), REFERENCE(post, (post.id, post.category))))

// CREATE TABLE `user` (
//   ...,
//   FOREIGN KEY (`post_id`, `post_category`)  REFERENCES `post` (`id`, `category`)
// )
</code></pre>
<h3><a href="#制約名" name="制約名" class="anchor"><span class="anchor-link"></span></a>制約名</h3>
<p>MySQLではCONSTRAINTを使用することで制約に対して任意の名前を付与することができます。この制約名はデータベース単位で一意の値である必要があります。</p>
<p>LDBCではCONSTRAINTメソッドが提供されているのでキー制約などの制約を設定する処理をCONSTRAINTメソッドに渡すだけで設定することができます。</p>
<pre class="prettyprint"><code class="language-scala 3">val user = Table[User](&quot;user&quot;)(
  column(&quot;id&quot;, BIGINT[Long], AUTO_INCREMENT),
  column(&quot;name&quot;, VARCHAR(255)),
  column(&quot;age&quot;, INT.UNSIGNED.DEFAULT(None)),
  column(&quot;post_id&quot;, BIGINT[Long])
)
  .keySet(table =&gt; CONSTRAINT(&quot;fk_post_id&quot;, FOREIGN_KEY(table.postId, REFERENCE(post, post.id))))

// CREATE TABLE `user` (
//   ...,
//   CONSTRAINT `fk_post_id` FOREIGN KEY (`post_id`)  REFERENCES `post` (`id`)
// )
</code></pre>
<div class="source-github">
The source code for this page can be found <a href="https://github.com/takapi327/ldbc/tree/v0.2.1/docs/target/mdoc/ja/01-Table-Definitions.md">here</a>.
</div>

<div class="nav-next">
<p><strong>Next:</strong> <a href="../ja/02-Custom-Data-Type.html">カスタム データ型</a></p>
</div>
</div>
<div class="large-3 show-for-large column" data-sticky-container>
<nav class="sidebar sticky" data-sticky data-anchor="docs" data-sticky-on="large">
<div class="page-nav">
<div class="nav-title">On this page:</div>
<div class="nav-toc">
<ul>
  <li><a href="../ja/01-Table-Definitions.html#テーブル定義" class="header">テーブル定義</a>
  <ul>
    <li><a href="../ja/01-Table-Definitions.html#データ型" class="header">データ型</a></li>
    <li><a href="../ja/01-Table-Definitions.html#属性" class="header">属性</a></li>
    <li><a href="../ja/01-Table-Definitions.html#キーの設定" class="header">キーの設定</a></li>
  </ul></li>
</ul>
</div>
</div>
</nav>
</div>
</div>

</section>
</div>

</div>

<footer class="site-footer">

<section class="site-footer-nav">
<div class="expanded row">
<div class="small-12 large-offset-2 large-10 column">
<div class="row site-footer-content">

<div class="small-12 medium-4 large-3 text-center column">
<div class="nav-links">
<ul>
<!-- <li><a href="https://www.example.com/products/">Products</a> -->
</ul>
</div>
</div>

</div>
</div>
</div>
</section>

<section class="site-footer-base">
<div class="expanded row">
<div class="small-12 large-offset-2 large-10 column">
<div class="row site-footer-content">

<div class="small-12 text-center large-9 column">

<!--
<div class="copyright">
<span class="text">&copy; 2024</span>
<a href="https://www.example.com" class="logo">logo</a>
</div>
-->
</div>

</div>
</div>
</div>
</section>
</footer>

</div>
</div>
</div>
</body>

<script type="text/javascript" src="../lib/foundation/dist/foundation.min.js"></script>
<script type="text/javascript">jQuery(document).foundation();</script>
<script type="text/javascript" src="../js/magellan.js"></script>

<style type="text/css">@import "../lib/prettify/prettify.css";</style>
<script type="text/javascript" src="../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">jQuery(function(){window.prettyPrint && prettyPrint()});</script>
<script type="text/javascript">jQuery(function(jq){initOldVersionWarnings(jq, '0.2.1', 'https://takapi327.github.io/ldbc/')});</script>


</html>
