<!DOCTYPE html>
<html class="no-js" lang="en">

<head>
<title>Type-safe Query Construction · LDBC</title>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="description" content='Documentation for ldbc'/>
<link rel="canonical" href="https://takapi327.github.io/ldbc/../en/03-Type-safe-Query-Builder.html"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:100normal,100italic,300normal,300italic,400normal,400italic,500normal,500italic,700normal,700italic,900normal,900italicc" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../lib/jquery/jquery.min.js"></script>
<script type="text/javascript" src="../js/page.js"></script>
<script type="text/javascript" src="../js/warnOldVersion.js"></script>
<script type="text/javascript" src="../js/groups.js"></script>
<script type="text/javascript" src="../js/snippets.js"></script>
<link rel="stylesheet" type="text/css" href="../lib/foundation/dist/foundation.min.css"/>
<link rel="stylesheet" type="text/css" href="../css/page.css"/>

<!--
<link rel="shortcut icon" href="../images/favicon.ico" />
-->
</head>

<body>
<div class="off-canvas-wrapper">
<div class="off-canvas-wrapper-inner" data-off-canvas-wrapper>

<div class="off-canvas position-left" id="off-canvas-menu" data-off-canvas>
<nav class="off-canvas-nav">
<div class="nav-home">
<a href="../en/index.html" >
<span class="home-icon">⌂</span>LDBC
</a>
<div class="version-number">
0.2.1
</div>
</div>
<div class="nav-toc">
<ul>
  <li><a href="../en/01-Table-Definitions.html" class="page">Table Definitions</a></li>
  <li><a href="../en/02-Custom-Data-Type.html" class="page">Custom Data Type</a></li>
  <li><a href="../en/03-Type-safe-Query-Builder.html" class="active page">Type-safe Query Construction</a></li>
  <li><a href="../en/04-Database-Connection.html" class="page">Database Connection</a></li>
  <li><a href="../en/05-Plain-SQL-Queries.html" class="page">Plain SQL Queries</a></li>
  <li><a href="../en/06-Generating-SchemaSPY-Documentation.html" class="page">SchemaSPY Document Generation</a></li>
  <li><a href="../en/07-Schema-Code-Generation.html" class="page">Schema Code Generation</a></li>
  <li><a href="../en/08-Perdormance.html" class="page">Performance</a></li>
</ul>
</div>

</nav>
</div>

<div class="off-canvas-content" data-off-canvas-content>

<header class="site-header expanded row">
<div class="small-12 column">
<a href="#" class="off-canvas-toggle hide-for-medium" data-toggle="off-canvas-menu"><svg class="svg-icon svg-icon-menu" version="1.1" id="Menu" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve"> <path class="svg-icon-menu-path" fill="#53CDEC" d="M16.4,9H3.6C3.048,9,3,9.447,3,10c0,0.553,0.048,1,0.6,1H16.4c0.552,0,0.6-0.447,0.6-1C17,9.447,16.952,9,16.4,9z M16.4,13
H3.6C3.048,13,3,13.447,3,14c0,0.553,0.048,1,0.6,1H16.4c0.552,0,0.6-0.447,0.6-1C17,13.447,16.952,13,16.4,13z M3.6,7H16.4
C16.952,7,17,6.553,17,6c0-0.553-0.048-1-0.6-1H3.6C3.048,5,3,5.447,3,6C3,6.553,3.048,7,3.6,7z"/></svg>
</a>
<div class="title"><a href="../en/index.html">LDBC</a></div>

<!--
<a href="https://www.example.com" class="logo show-for-medium">logo</a>
-->
</div>
</header>

<div class="expanded row">

<div class="medium-3 large-2 show-for-medium column">
<nav class="site-nav">
<div class="nav-home">
<a href="../en/index.html" >
<span class="home-icon">⌂</span>LDBC
</a>
<div class="version-number">
0.2.1
</div>
</div>
<div class="nav-toc">
<ul>
  <li><a href="../en/01-Table-Definitions.html" class="page">Table Definitions</a></li>
  <li><a href="../en/02-Custom-Data-Type.html" class="page">Custom Data Type</a></li>
  <li><a href="../en/03-Type-safe-Query-Builder.html" class="active page">Type-safe Query Construction</a></li>
  <li><a href="../en/04-Database-Connection.html" class="page">Database Connection</a></li>
  <li><a href="../en/05-Plain-SQL-Queries.html" class="page">Plain SQL Queries</a></li>
  <li><a href="../en/06-Generating-SchemaSPY-Documentation.html" class="page">SchemaSPY Document Generation</a></li>
  <li><a href="../en/07-Schema-Code-Generation.html" class="page">Schema Code Generation</a></li>
  <li><a href="../en/08-Perdormance.html" class="page">Performance</a></li>
</ul>
</div>

</nav>
</div>

<div class="small-12 medium-9 large-10 column">
<section class="site-content">

<span id="version-warning"></span>

<div class="page-header row">
<div class="medium-12 show-for-medium column">
<div class="nav-breadcrumbs">
<ul>
  <li><a href="../en/index.html">LDBC</a></li>
  <li>Type-safe Query Construction</li>
</ul>
</div>
</div>
</div>

<div class="page-content row">
<div class="small-12 large-9 column" id="docs">
<h1><a href="#type-safe-query-construction" name="type-safe-query-construction" class="anchor"><span class="anchor-link"></span></a>Type-safe Query Construction</h1>
<p>This chapter describes how to use LDBC-built table definitions to construct type-safe queries.</p>
<p>The following dependencies must be set up for the project</p>
<pre class="prettyprint"><code class="language-scala">libraryDependencies += &quot;io.github.takapi327&quot; %% &quot;ldbc-query-builder&quot; % &quot;0.2.1&quot;
</code></pre>
<p>If you have not yet read how to define tables in LDBC, we recommend that you read the chapter <a href="/ldbc/en/01-Table-Definitions.html">Table Definitions</a> first.</p>
<p>The following code example assumes the following import</p>
<pre class="prettyprint"><code class="language-scala 3">import cats.effect.IO
import ldbc.core.*
import ldbc.query.builder.TableQuery
</code></pre>
<p>LDBC performs type-safe query construction by passing table definitions to TableQuery.</p>
<pre class="prettyprint"><code class="language-scala 3">case class User(
  id: Long,
  name: String,
  age: Option[Int],
)

val table = Table[User](&quot;user&quot;)(
  column(&quot;id&quot;, BIGINT, AUTO_INCREMENT, PRIMARY_KEY),
  column(&quot;name&quot;, VARCHAR(255)),
  column(&quot;age&quot;, INT.UNSIGNED.DEFAULT(None)),
)

val userQuery = TableQuery[IO, User](table)
</code></pre>
<h2><a href="#select" name="select" class="anchor"><span class="anchor-link"></span></a>SELECT</h2>
<p>A type-safe way to construct a SELECT statement is to use the <code>select</code> method provided by TableQuery, which is implemented in LDBC to mimic a plain query, making query construction intuitive. LDBC is also designed so that you can see at a glance what kind of query is being constructed.</p>
<p>To construct a SELECT statement that retrieves only specific columns, simply specify the columns you want to retrieve in the <code>select</code> method.</p>
<pre class="prettyprint"><code class="language-scala 3">val select = userQuery.select(_.id)

select.statement === &quot;SELECT `id` FROM user&quot;
</code></pre>
<p>To specify multiple columns, simply specify the columns you wish to retrieve using the <code>select</code> method and return a tuple of the specified columns.</p>
<pre class="prettyprint"><code class="language-scala 3">val select = userQuery.select(user =&gt; (user.id, user.name))

select.statement === &quot;SELECT `id`, `name` FROM user&quot;
</code></pre>
<p>If you want to specify all columns, you can construct it by using the <code>selectAll</code> method provided by TableQuery.</p>
<pre class="prettyprint"><code class="language-scala 3">val select = userQuery.selectAll

select.statement === &quot;SELECT `id`, `name`, `age` FROM user&quot;
</code></pre>
<p>If you want to get the number of a specific column, you can construct it by using <code>count</code> on the specified column.</p>
<pre class="prettyprint"><code class="language-scala 3">val select = userQuery.select(_.id.count)

select.statement === &quot;SELECT COUNT(id) FROM user&quot;
</code></pre>
<h3><a href="#where" name="where" class="anchor"><span class="anchor-link"></span></a>WHERE</h3>
<p>A type-safe way to set a Where condition in a query is to use the <code>where</code> method.</p>
<pre class="prettyprint"><code class="language-scala 3">val select = userQuery.select(_.id).where(_.name === &quot;Test&quot;)

select.statement === &quot;SELECT `id` FROM user WHERE name = ?&quot;
</code></pre>
<p>The following is a list of conditions that can be used in the <code>where</code> method.</p>
<table>
  <thead>
    <tr>
      <th>condition </th>
      <th>statement </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>=== </td>
      <td><code>column = ?</code> </td>
    </tr>
    <tr>
      <td>&gt;= </td>
      <td><code>column &gt;= ?</code> </td>
    </tr>
    <tr>
      <td>&gt; </td>
      <td><code>column &gt; ?</code> </td>
    </tr>
    <tr>
      <td>&lt;= </td>
      <td><code>column &lt;= ?</code> </td>
    </tr>
    <tr>
      <td>&lt; </td>
      <td><code>column &lt; ?</code> </td>
    </tr>
    <tr>
      <td>&lt;&gt; </td>
      <td><code>column &lt;&gt; ?</code> </td>
    </tr>
    <tr>
      <td>!== </td>
      <td><code>column != ?</code> </td>
    </tr>
    <tr>
      <td>IS (&ldquo;TRUE&rdquo;/&ldquo;FALSE&rdquo;/&ldquo;UNKNOWN&rdquo;/&ldquo;NULL&rdquo;) </td>
      <td><code>column IS {TRUE/FALSE/UNKNOWN/NULL}</code> </td>
    </tr>
    <tr>
      <td>&lt;=&gt; </td>
      <td><code>column &lt;=&gt; ?</code> </td>
    </tr>
    <tr>
      <td>IN (value, value, &hellip;) </td>
      <td><code>column IN (?, ?, ...)</code> </td>
    </tr>
    <tr>
      <td>BETWEEN (start, end) </td>
      <td><code>column BETWEEN ? AND ?</code> </td>
    </tr>
    <tr>
      <td>LIKE (value) </td>
      <td><code>column LIKE ?</code> </td>
    </tr>
    <tr>
      <td>LIKE_ESCAPE (like, escape) </td>
      <td><code>column LIKE ? ESCAPE ?</code> </td>
    </tr>
    <tr>
      <td>REGEXP (value) </td>
      <td><code>column REGEXP ?</code> </td>
    </tr>
    <tr>
      <td><code>&lt;&lt;</code> (value) </td>
      <td><code>column &lt;&lt; ?</code> </td>
    </tr>
    <tr>
      <td><code>&gt;&gt;</code> (value) </td>
      <td><code>column &gt;&gt; ?</code> </td>
    </tr>
    <tr>
      <td>DIV (cond, result) </td>
      <td><code>column DIV ? = ?</code> </td>
    </tr>
    <tr>
      <td>MOD (cond, result) </td>
      <td><code>column MOD ? = ?</code> </td>
    </tr>
    <tr>
      <td>^ (value) </td>
      <td><code>column ^ ?</code> </td>
    </tr>
    <tr>
      <td>~ (value) </td>
      <td><code>~column = ?</code> </td>
    </tr>
  </tbody>
</table>
<h3><a href="#group-by-having" name="group-by-having" class="anchor"><span class="anchor-link"></span></a>GROUP BY/Having</h3>
<p>A type-safe way to set a Group By clause in a query is to use the <code>groupBy</code> method.</p>
<p>Using <code>groupBy</code> allows you to group data based on the value of a column name you specify when retrieving data with <code>select</code>.</p>
<pre class="prettyprint"><code class="language-scala 3">val select = userQuery.select(user =&gt; (user.id, user.name, user.age)).groupBy(_._3)

select.statement === &quot;SELECT `id`, `name`, `age` FROM user GROUP BY age&quot;
</code></pre>
<p>When grouping, the number of data that can be retrieved with <code>select</code> is the number of groups. So, when grouping, you can retrieve the values of the columns specified for grouping, or the results of aggregating the column values by group using the provided functions.</p>
<p>The <code>having</code> allows you to set the conditions for retrieval with respect to data grouped and retrieved by <code>groupBy</code>.</p>
<pre class="prettyprint"><code class="language-scala 3">val select = userQuery.select(user =&gt; (user.id, user.name, user.age)).groupBy(_._3).having(_._3 &gt; 20)

select.statement === &quot;SELECT `id`, `name`, `age` FROM user GROUP BY age HAVING age &gt; ?&quot;
</code></pre>
<h3><a href="#order-by" name="order-by" class="anchor"><span class="anchor-link"></span></a>ORDER BY</h3>
<p>A type-safe way to set an ORDER BY clause in a query is to use the <code>orderBy</code> method.</p>
<p>Using <code>orderBy</code> allows you to get the results sorted by the values of the columns you specify when retrieving data with <code>select</code>.</p>
<pre class="prettyprint"><code class="language-scala 3">val select = userQuery.select(user =&gt; (user.id, user.name, user.age)).orderBy(_.age)

select.statement === &quot;SELECT `id`, `name`, `age` FROM user ORDER BY age&quot;
</code></pre>
<p>If you want to specify ascending/descending order, simply call <code>asc</code>/<code>desc</code> for the columns, respectively.</p>
<pre class="prettyprint"><code class="language-scala 3">val desc = userQuery.select(user =&gt; (user.id, user.name, user.age)).orderBy(_.age.desc)

desc.statement === &quot;SELECT `id`, `name`, `age` FROM user ORDER BY age DESC&quot;

val asc = userQuery.select(user =&gt; (user.id, user.name, user.age)).orderBy(_.age.asc)

asc.statement === &quot;SELECT `id`, `name`, `age` FROM user ORDER BY age ASC&quot;
</code></pre>
<h3><a href="#limit-offset" name="limit-offset" class="anchor"><span class="anchor-link"></span></a>LIMIT/OFFSET</h3>
<p>A type-safe way to set the LIMIT and OFFSET clauses in a query is to use the <code>limit</code>/<code>offset</code> methods.</p>
<p>The <code>limit</code> can be set to the maximum number of rows of data to retrieve when <code>select</code> is executed, and the <code>offset</code> can be set to the number of rows of data to retrieve.</p>
<pre class="prettyprint"><code class="language-scala 3">val select = userQuery.select(user =&gt; (user.id, user.name, user.age)).limit(100).offset(50)

select.statement === &quot;SELECT `id`, `name`, `age` FROM user LIMIT ? OFFSET ?&quot;
</code></pre>
<h2><a href="#join-left-join-right-join" name="join-left-join-right-join" class="anchor"><span class="anchor-link"></span></a>JOIN/LEFT JOIN/RIGHT JOIN</h2>
<p>A type-safe way to set a Join on a query is to use the <code>join</code>/<code>leftJoin</code>/<code>rightJoin</code> methods.</p>
<p>The following definition is used as a sample for Join.</p>
<pre class="prettyprint"><code class="language-scala 3">case class Country(code: String, name: String)
object Country:
  val table = Table[Country](&quot;country&quot;)(
    column(&quot;code&quot;, CHAR(3), PRIMARY_KEY),
    column(&quot;name&quot;, VARCHAR(255))
  )

case class City(id: Long, name: String, countryCode: String)
object City:
  val table = Table[City](&quot;city&quot;)(
    column(&quot;id&quot;, BIGINT, AUTO_INCREMENT, PRIMARY_KEY),
    column(&quot;name&quot;, VARCHAR(255)),
    column(&quot;country_code&quot;, CHAR(3))
  )

case class CountryLanguage(
  countryCode: String,
  language:    String
)
object CountryLanguage:
  val table: Table[CountryLanguage] = Table[CountryLanguage](&quot;country_language&quot;)(
    column(&quot;country_code&quot;, CHAR(3)),
    column(&quot;language&quot;, CHAR(30))
  )

val countryQuery = TableQuery[IO, Country](Country.table)
val cityQuery = TableQuery[IO, City](City.table)
val countryLanguageQuery = TableQuery[IO, CountryLanguage](CountryLanguage.table)
</code></pre>
<p>If you want to do a simple Join first, use <code>join</code>. The first argument of <code>join</code> is the table to be joined, and the second argument is a function that compares the source table with the columns of the table to be joined. This corresponds to the ON clause in Join.</p>
<p>After the join, the <code>select</code> will specify columns from the two tables.</p>
<pre class="prettyprint"><code class="language-scala 3">val join = countryQuery.join(cityQuery)((country, city) =&gt; country.code === city.countryCode)
  .select((country, city) =&gt; (country.name, city.name))

join.statement = &quot;SELECT country.`name`, city.`name` FROM country JOIN city ON country.code = city.country_code&quot;
</code></pre>
<p>Next, if you want to perform a Left Join, which is a left outer join, use <code>leftJoin</code>. The implementation itself is the same as for a simple Join, only <code>join</code> is changed to <code>leftJoin</code>.</p>
<pre class="prettyprint"><code class="language-scala 3">val leftJoin = countryQuery.leftJoin(cityQuery)((country, city) =&gt; country.code === city.countryCode)
  .select((country, city) =&gt; (country.name, city.name))

join.statement = &quot;SELECT country.`name`, city.`name` FROM country LEFT JOIN city ON country.code = city.country_code&quot;
</code></pre>
<p>The difference from a simple Join is that when using <code>leftJoin</code>, the records retrieved from the table to be joined may be NULL.</p>
<p>Therefore, in LDBC, all records in the column retrieved from the table passed to <code>leftJoin</code> will be of type Option.</p>
<pre class="prettyprint"><code class="language-scala 3">val leftJoin = countryQuery.leftJoin(cityQuery)((country, city) =&gt; country.code === city.countryCode)
  .select((country, city) =&gt; (country.name, city.name)) // (String, Option[String])
</code></pre>
<p>Next, if you want to perform a Right Join, which is a right outer join, use <code>rightJoin</code>. The implementation itself is the same as that of simple Join, only <code>join</code> is changed to <code>rightJoin</code>.</p>
<pre class="prettyprint"><code class="language-scala 3">val rightJoin = countryQuery.rightJoin(cityQuery)((country, city) =&gt; country.code === city.countryCode)
  .select((country, city) =&gt; (country.name, city.name))

join.statement = &quot;SELECT country.`name`, city.`name` FROM country RIGHT JOIN city ON country.code = city.country_code&quot;
</code></pre>
<p>The difference from a simple Join is that when using <code>rightJoin</code>, the records retrieved from the join source table may be NULL.</p>
<p>Therefore, in LDBC, all records of a column retrieved from a join source table using <code>rightJoin</code> are of type Option.</p>
<pre class="prettyprint"><code class="language-scala 3">val rightJoin = countryQuery.rightJoin(cityQuery)((country, city) =&gt; country.code === city.countryCode)
  .select((country, city) =&gt; (country.name, city.name)) // (Option[String], String)
</code></pre>
<p>If multiple joins are desired, this can be accomplished by calling any Join method in the method chain.</p>
<pre class="prettyprint"><code class="language-scala 3">val join = 
  (countryQuery join cityQuery)((country, city) =&gt; country.code === city.countryCode)
    .rightJoin(countryLanguageQuery)((_, city, countryLanguage) =&gt; city.countryCode === countryLanguage.countryCode)
    .select((country, city, countryLanguage) =&gt; (country.name, city.name, countryLanguage.language)) // (Option[String], Option[String], String)]

join.statement =
  &quot;&quot;&quot;
    |SELECT
    |  country.`name`, 
    |  city.`name`,
    |  country_language.`language`
    |FROM country
    |JOIN city ON country.code = city.country_code
    |RIGHT JOIN country_language ON city.country_code = country_language.country_code
    |&quot;&quot;&quot;.stripMargin
</code></pre>
<p>Note that a <code>rightJoin</code> join with multiple joins will result in NULL-acceptable access to all records retrieved from the previously joined table, regardless of what the previous join was.</p>
<h2><a href="#custom-data-type" name="custom-data-type" class="anchor"><span class="anchor-link"></span></a>Custom Data Type</h2>
<p>In the previous section, we used the <code>mapping</code> method of DataType to map custom types to DataType in order to use user-specific or unsupported types. (<a href="/ldbc/en/02-Custom-Data-Type.html">reference</a>)</p>
<p>LDBC separates the table definition from the process of connecting to the database. Therefore, if you want to retrieve data from the database and convert it to a user-specific or unsupported type, you must link the method of retrieving data from the ResultSet to the user-specific or unsupported type.</p>
<p>For example, if you want to map a user-defined Enum to a string type</p>
<pre class="prettyprint"><code class="language-scala 3">enum Custom:
  case ...

given ResultSetReader[IO, Custom] =
  ResultSetReader.mapping[IO, str, Custom](str =&gt; Custom.valueOf(str))
</code></pre>
<p>※ This process may be integrated with DataType mapping in a future version.</p>
<h2><a href="#insert" name="insert" class="anchor"><span class="anchor-link"></span></a>INSERT</h2>
<p>A type-safe way to construct an INSERT statement is to use the following methods provided by TableQuery.</p>
<ul>
  <li>insert</li>
  <li>insertInto</li>
  <li>+=</li>
  <li>++=</li>
</ul>
<p><strong>insert</strong></p>
<p>The <code>insert</code> method is passed a tuple of data to insert. The tuples must have the same number and type of properties as the model. Also, the order of the inserted data must be in the same order as the model properties and table columns.</p>
<pre class="prettyprint"><code class="language-scala 3">val insert = userQuery.insert((1L, &quot;name&quot;, None))

insert.statement === &quot;INSERT INTO user (`id`, `name`, `age`) VALUES(?, ?, ?)&quot;
</code></pre>
<p>If you want to insert multiple data, you can construct it by passing multiple tuples to the <code>insert</code> method.</p>
<pre class="prettyprint"><code class="language-scala 3">val insert = userQuery.insert((1L, &quot;name&quot;, None), (2L, &quot;name&quot;, None))

insert.statement === &quot;INSERT INTO user (`id`, `name`, `age`) VALUES(?, ?, ?), (?, ?, ?)&quot;
</code></pre>
<p><strong>insertInto</strong></p>
<p>The <code>insert</code> method inserts data into all columns the table has, but if you want to insert data only into specific columns, use the <code>insertInto</code> method.</p>
<p>This can be used, for example, to exclude data insertion into columns with AutoIncrement or Default values.</p>
<pre class="prettyprint"><code class="language-scala 3">val insert = userQuery.insertInto(user =&gt; (user.name, user.age)).values((&quot;name&quot;, None))

insert.statement === &quot;INSERT INTO user (`name`, `age`) VALUES(?, ?)&quot;
</code></pre>
<p>If you want to insert multiple data, you can construct it by passing an array of tuples to <code>values</code>.</p>
<pre class="prettyprint"><code class="language-scala 3">val insert = userQuery.insertInto(user =&gt; (user.name, user.age)).values(List((&quot;name&quot;, None), (&quot;name&quot;, Some(20))))

insert.statement === &quot;INSERT INTO user (`name`, `age`) VALUES(?, ?), (?, ?)&quot;
</code></pre>
<p><strong>+=</strong></p>
<p>The <code>+=</code> method can be used to construct an INSERT statement using a model. Note that when using a model, data is inserted into all columns.</p>
<pre class="prettyprint"><code class="language-scala 3">val insert = userQuery += User(1L, &quot;name&quot;, None)

insert.statement === &quot;INSERT INTO user (`id`, `name`, `age`) VALUES(?, ?, ?)&quot;
</code></pre>
<p><strong>++=</strong></p>
<p>Use the <code>++=</code> method if you want to insert multiple data using the model.</p>
<pre class="prettyprint"><code class="language-scala 3">val insert = userQuery ++= List(User(1L, &quot;name&quot;, None), User(2L, &quot;name&quot;, None))

insert.statement === &quot;INSERT INTO user (`id`, `name`, `age`) VALUES(?, ?, ?), (?, ?, ?)&quot;
</code></pre>
<h3><a href="#on-duplicate-key-update" name="on-duplicate-key-update" class="anchor"><span class="anchor-link"></span></a>ON DUPLICATE KEY UPDATE</h3>
<p>Inserting a row with an ON DUPLICATE KEY UPDATE clause will cause an UPDATE of the old row if the UNIQUE index or PRIMARY KEY has duplicate values.</p>
<p>There are two ways to achieve this in LDBC: using <code>insertOrUpdate{s}</code> or using <code>onDuplicateKeyUpdate</code> for <code>Insert</code>.</p>
<pre class="prettyprint"><code class="language-scala 3">val insert = userQuery.insertOrUpdate((1L, &quot;name&quot;, None))

insert.statement === &quot;INSERT INTO user (`id`, `name`, `age`) VALUES(?, ?, ?) AS new_user ON DUPLICATE KEY UPDATE `id` = new_user.`id`, `name` = new_user.`name`, `age` = new_user.`age`&quot;
</code></pre>
<p>Note that if you use <code>insertOrUpdate{s}</code>, all columns will be updated. If you have duplicate values and wish to update only certain columns, use <code>onDuplicateKeyUpdate</code> to specify only the columns you wish to update.</p>
<pre class="prettyprint"><code class="language-scala 3">val insert = userQuery.insert((1L, &quot;name&quot;, None)).onDuplicateKeyUpdate(v =&gt; (v.name, v.age))

insert.statement === &quot;INSERT INTO user (`id`, `name`, `age`) VALUES(?, ?, ?) AS new_user ON DUPLICATE KEY UPDATE `name` = new_user.`name`, `age` = new_user.`age`&quot;
</code></pre>
<h2><a href="#update" name="update" class="anchor"><span class="anchor-link"></span></a>UPDATE</h2>
<p>A type-safe way to construct an UPDATE statement is to use the <code>update</code> method provided by TableQuery.</p>
<p>The first argument of the <code>update</code> method is the name of the model property, not the column name of the table, and the second argument is the value to be updated. The type of the value passed as the second argument must be the same as the type of the property specified in the first argument.</p>
<pre class="prettyprint"><code class="language-scala 3">val update = userQuery.update(&quot;name&quot;, &quot;update name&quot;)

update.statement === &quot;UPDATE user SET name = ?&quot;
</code></pre>
<p>If a property name that does not exist is specified as the first argument, a compile error occurs.</p>
<pre class="prettyprint"><code class="language-scala 3">val update = userQuery.update(&quot;hoge&quot;, &quot;update name&quot;) // Compile error
</code></pre>
<p>If you want to update multiple columns, use the <code>set</code> method.</p>
<pre class="prettyprint"><code class="language-scala 3">val update = userQuery.update(&quot;name&quot;, &quot;update name&quot;).set(&quot;age&quot;, Some(20))

update.statement === &quot;UPDATE user SET name = ?, age = ?&quot;
</code></pre>
<p>You can also prevent the <code>set</code> method from generating queries based on conditions.</p>
<pre class="prettyprint"><code class="language-scala 3">val update = userQuery.update(&quot;name&quot;, &quot;update name&quot;).set(&quot;age&quot;, Some(20), false)

update.statement === &quot;UPDATE user SET name = ?&quot;
</code></pre>
<p>You can also use a model to construct the UPDATE statement. Note that if you use a model, all columns will be updated.</p>
<pre class="prettyprint"><code class="language-scala 3">val update = userQuery.update(User(1L, &quot;update name&quot;, None))

update.statement === &quot;UPDATE user SET id = ?, name = ?, age = ?&quot;
</code></pre>
<h3><a href="#where" name="where" class="anchor"><span class="anchor-link"></span></a>WHERE</h3>
<p>The <code>where</code> method can also be used to set a where condition on the update statement.</p>
<pre class="prettyprint"><code class="language-scala 3">val update = userQuery.update(&quot;name&quot;, &quot;update name&quot;).set(&quot;age&quot;, Some(20)).where(_.id === 1)

update.statement === &quot;UPDATE user SET name = ?, age = ? WHERE id = ?&quot;
</code></pre>
<p>See <a href="/ldbc/en/03-Type-safe-Query-Builder.html#where">where item</a> in the Insert statement for conditions that can be used in the <code>where</code> method.</p>
<h2><a href="#delete" name="delete" class="anchor"><span class="anchor-link"></span></a>DELETE</h2>
<p>A type-safe way to construct a DELETE statement is to use the <code>delete</code> method provided by TableQuery.</p>
<pre class="prettyprint"><code class="language-scala 3">val delete = userQuery.delete

delete.statement === &quot;DELETE FROM user&quot;
</code></pre>
<h3><a href="#where" name="where" class="anchor"><span class="anchor-link"></span></a>WHERE</h3>
<p>The <code>where</code> method can also be used to set a Where condition on a delete statement.</p>
<pre class="prettyprint"><code class="language-scala 3">val delete = userQuery.delete.where(_.id === 1)

delete.statement === &quot;DELETE FROM user WHERE id = ?&quot;
</code></pre>
<p>See <a href="/ldbc/en/03-Type-safe-Query-Builder.html#where">where item</a> in the Insert statement for conditions that can be used in the <code>where</code> method.</p>
<h2><a href="#ddl" name="ddl" class="anchor"><span class="anchor-link"></span></a>DDL</h2>
<p>A type-safe way to construct DDL is to use the following methods provided by TableQuery.</p>
<ul>
  <li>createTable</li>
  <li>dropTable</li>
  <li>truncateTable</li>
</ul>
<p>If you are using spec2, you can run DDL before and after the test as follows.</p>
<pre class="prettyprint"><code class="language-scala 3">import cats.effect.IO
import cats.effect.unsafe.implicits.global

import org.specs2.mutable.Specification
import org.specs2.specification.core.Fragments
import org.specs2.specification.BeforeAfterEach

object Test extends Specification, BeforeAfterEach:

  override def before: Fragments =
    step((tableQuery.createTable.update.autoCommit(dataSource) &gt;&gt; IO.println(&quot;Complete create table&quot;)).unsafeRunSync())

  override def after: Fragments =
    step((tableQuery.dropTable.update.autoCommit(dataSource) &gt;&gt; IO.println(&quot;Complete drop table&quot;)).unsafeRunSync())
</code></pre>
<div class="source-github">
The source code for this page can be found <a href="https://github.com/takapi327/ldbc/tree/v0.2.1/docs/target/mdoc/en/03-Type-safe-Query-Builder.md">here</a>.
</div>

<div class="nav-next">
<p><strong>Next:</strong> <a href="../en/04-Database-Connection.html">Database Connection</a></p>
</div>
</div>
<div class="large-3 show-for-large column" data-sticky-container>
<nav class="sidebar sticky" data-sticky data-anchor="docs" data-sticky-on="large">
<div class="page-nav">
<div class="nav-title">On this page:</div>
<div class="nav-toc">
<ul>
  <li><a href="../en/03-Type-safe-Query-Builder.html#type-safe-query-construction" class="header">Type-safe Query Construction</a>
  <ul>
    <li><a href="../en/03-Type-safe-Query-Builder.html#select" class="header">SELECT</a></li>
    <li><a href="../en/03-Type-safe-Query-Builder.html#join-left-join-right-join" class="header">JOIN/LEFT JOIN/RIGHT JOIN</a></li>
    <li><a href="../en/03-Type-safe-Query-Builder.html#custom-data-type" class="header">Custom Data Type</a></li>
    <li><a href="../en/03-Type-safe-Query-Builder.html#insert" class="header">INSERT</a></li>
    <li><a href="../en/03-Type-safe-Query-Builder.html#update" class="header">UPDATE</a></li>
    <li><a href="../en/03-Type-safe-Query-Builder.html#delete" class="header">DELETE</a></li>
    <li><a href="../en/03-Type-safe-Query-Builder.html#ddl" class="header">DDL</a></li>
  </ul></li>
</ul>
</div>
</div>
</nav>
</div>
</div>

</section>
</div>

</div>

<footer class="site-footer">

<section class="site-footer-nav">
<div class="expanded row">
<div class="small-12 large-offset-2 large-10 column">
<div class="row site-footer-content">

<div class="small-12 medium-4 large-3 text-center column">
<div class="nav-links">
<ul>
<!-- <li><a href="https://www.example.com/products/">Products</a> -->
</ul>
</div>
</div>

</div>
</div>
</div>
</section>

<section class="site-footer-base">
<div class="expanded row">
<div class="small-12 large-offset-2 large-10 column">
<div class="row site-footer-content">

<div class="small-12 text-center large-9 column">

<!--
<div class="copyright">
<span class="text">&copy; 2024</span>
<a href="https://www.example.com" class="logo">logo</a>
</div>
-->
</div>

</div>
</div>
</div>
</section>
</footer>

</div>
</div>
</div>
</body>

<script type="text/javascript" src="../lib/foundation/dist/foundation.min.js"></script>
<script type="text/javascript">jQuery(document).foundation();</script>
<script type="text/javascript" src="../js/magellan.js"></script>

<style type="text/css">@import "../lib/prettify/prettify.css";</style>
<script type="text/javascript" src="../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">jQuery(function(){window.prettyPrint && prettyPrint()});</script>
<script type="text/javascript">jQuery(function(jq){initOldVersionWarnings(jq, '0.2.1', 'https://takapi327.github.io/ldbc/')});</script>


</html>
