{%
  laika.title = ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒ¼ãƒˆ
  laika.metadata.language = ja
%}

# ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒ¼ãƒˆ (0.4.xã‹ã‚‰0.5.xã¸ã®ç§»è¡Œ)

## ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸

**æ–°ã—ãè¿½åŠ ã•ã‚ŒãŸãƒ‘ãƒƒã‚±ãƒ¼ã‚¸**

| Module / Platform                | JVM | Scala Native | Scala.js | Scaladoc                                                                                                                                                              |
|----------------------------------|:---:|:------------:|:--------:|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `ldbc-zio-interop`               |  âœ…  |      âŒ       |    âœ…     | [![Scaladoc](https://img.shields.io/badge/javadoc-0.5.0-brightgreen.svg?label=Scaladoc)](https://javadoc.io/doc/io.github.takapi327/ldbc-zio-interop_3)               |
| `ldbc-authentication-plugin`     |  âœ…  |      âœ…       |    âœ…     | [![Scaladoc](https://img.shields.io/badge/javadoc-0.5.0-brightgreen.svg?label=Scaladoc)](https://javadoc.io/doc/io.github.takapi327/ldbc-authentication-plugin_3)     |
| `ldbc-aws-authentication-plugin` |  âœ…  |      âœ…       |    âœ…     | [![Scaladoc](https://img.shields.io/badge/javadoc-0.5.0-brightgreen.svg?label=Scaladoc)](https://javadoc.io/doc/io.github.takapi327/ldbc-aws-authentication-plugin_3) |

**å»ƒæ­¢ã•ã‚ŒãŸãƒ‘ãƒƒã‚±ãƒ¼ã‚¸**

| Module / Platform    | JVM | Scala Native | Scala.js |  
|----------------------|:---:|:------------:|:--------:|
| `ldbc-hikari`        |  âœ…  |      âŒ       |    âŒ     | 

**å…¨ã¦ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸**

| Module / Platform                | JVM | Scala Native | Scala.js | Scaladoc                                                                                                                                                              |
|----------------------------------|:---:|:------------:|:--------:|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `ldbc-sql`                       |  âœ…  |      âœ…       |    âœ…     | [![Scaladoc](https://img.shields.io/badge/javadoc-0.5.0-brightgreen.svg?label=Scaladoc)](https://javadoc.io/doc/io.github.takapi327/ldbc-sql_3)                       |
| `ldbc-core`                      |  âœ…  |      âœ…       |    âœ…     | [![Scaladoc](https://img.shields.io/badge/javadoc-0.5.0-brightgreen.svg?label=Scaladoc)](https://javadoc.io/doc/io.github.takapi327/ldbc-core_3)                      |
| `ldbc-connector`                 |  âœ…  |      âœ…       |    âœ…     | [![Scaladoc](https://img.shields.io/badge/javadoc-0.5.0-brightgreen.svg?label=Scaladoc)](https://javadoc.io/doc/io.github.takapi327/ldbc-connector_3)                 |
| `jdbc-connector`                 |  âœ…  |      âŒ       |    âŒ     | [![Scaladoc](https://img.shields.io/badge/javadoc-0.5.0-brightgreen.svg?label=Scaladoc)](https://javadoc.io/doc/io.github.takapi327/jdbc-connector_3)                 |
| `ldbc-dsl`                       |  âœ…  |      âœ…       |    âœ…     | [![Scaladoc](https://img.shields.io/badge/javadoc-0.5.0-brightgreen.svg?label=Scaladoc)](https://javadoc.io/doc/io.github.takapi327/ldbc-dsl_3)                       |
| `ldbc-statement`                 |  âœ…  |      âœ…       |    âœ…     | [![Scaladoc](https://img.shields.io/badge/javadoc-0.5.0-brightgreen.svg?label=Scaladoc)](https://javadoc.io/doc/io.github.takapi327/ldbc-statement_3)                 |
| `ldbc-query-builder`             |  âœ…  |      âœ…       |    âœ…     | [![Scaladoc](https://img.shields.io/badge/javadoc-0.5.0-brightgreen.svg?label=Scaladoc)](https://javadoc.io/doc/io.github.takapi327/ldbc-query-builder_3)             |
| `ldbc-schema`                    |  âœ…  |      âœ…       |    âœ…     | [![Scaladoc](https://img.shields.io/badge/javadoc-0.5.0-brightgreen.svg?label=Scaladoc)](https://javadoc.io/doc/io.github.takapi327/ldbc-schema_3)                    |
| `ldbc-codegen`                   |  âœ…  |      âœ…       |    âœ…     | [![Scaladoc](https://img.shields.io/badge/javadoc-0.5.0-brightgreen.svg?label=Scaladoc)](https://javadoc.io/doc/io.github.takapi327/ldbc-codegen_3)                   |
| `ldbc-plugin`                    |  âœ…  |      âŒ       |    âŒ     | [![Scaladoc](https://img.shields.io/badge/javadoc-0.5.0-brightgreen.svg?label=Scaladoc)](https://javadoc.io/doc/io.github.takapi327/ldbc-plugin_2.12_1.0)             |
| `ldbc-zio-interop`               |  âœ…  |      âŒ       |    âœ…     | [![Scaladoc](https://img.shields.io/badge/javadoc-0.5.0-brightgreen.svg?label=Scaladoc)](https://javadoc.io/doc/io.github.takapi327/ldbc-zio-interop_3)               |
| `ldbc-authentication-plugin`     |  âœ…  |      âœ…       |    âœ…     | [![Scaladoc](https://img.shields.io/badge/javadoc-0.5.0-brightgreen.svg?label=Scaladoc)](https://javadoc.io/doc/io.github.takapi327/ldbc-authentication-plugin_3)     |
| `ldbc-aws-authentication-plugin` |  âœ…  |      âœ…       |    âœ…     | [![Scaladoc](https://img.shields.io/badge/javadoc-0.5.0-brightgreen.svg?label=Scaladoc)](https://javadoc.io/doc/io.github.takapi327/ldbc-aws-authentication-plugin_3) |

## ğŸ¯ ä¸»è¦ãªå¤‰æ›´ç‚¹

### 1. ZIOã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ ã‚µãƒãƒ¼ãƒˆã®è¿½åŠ 

0.5.0ã‹ã‚‰ã€ldbcã§ZIOã‚’ã‚ˆã‚Šç°¡å˜ã«ä½¿ç”¨ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

```scala
libraryDependencies += "io.github.takapi327" %% "ldbc-zio-interop" % "0.5.0"
```

**ä½¿ç”¨ä¾‹:**
```scala
import zio.*
import ldbc.zio.interop.*
import ldbc.connector.*
import ldbc.dsl.*

object Main extends ZIOAppDefault:
  
  private val datasource =
    MySQLDataSource
      .build[Task](
        host = "127.0.0.1",
        port = 3306,
        user = "ldbc"
      )
      .setPassword("password")
      .setDatabase("world")

  private val program =
    for
      connection <- datasource.getConnection
      connector = Connector.fromConnection(connection)
      result     <- sql"SELECT 1".query[Int].to[List].readOnly(connector)
    yield result

  override def run = program
```

### 2. èªè¨¼ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®å¼·åŒ–

æ–°ã—ã„èªè¨¼ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒè¿½åŠ ã•ã‚Œã¾ã—ãŸã€‚ã“ã‚Œã‚‰ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¯Pure Scala3ã§å®Ÿè£…ã•ã‚Œã€å…¨ã¦ã®ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ï¼ˆJVMã€JSã€Nativeï¼‰ã§åˆ©ç”¨å¯èƒ½ã§ã™ã€‚

#### MySQL Clear Passwordèªè¨¼

```scala
libraryDependencies += "io.github.takapi327" %% "ldbc-authentication-plugin" % "0.5.0"
```

```scala
import ldbc.connector.*
import ldbc.authentication.plugin.*

val datasource = MySQLDataSource
  .build[IO](
    host = "localhost",
    port = 3306,
    user = "cleartext-user"
  )
  .setPassword("plaintext-password")
  .setDatabase("mydb")
  .setDefaultAuthenticationPlugin(MysqlClearPasswordPlugin)
```

#### AWS Aurora IAMèªè¨¼

```scala
libraryDependencies += "io.github.takapi327" %% "ldbc-aws-authentication-plugin" % "0.5.0"
```

```scala
import ldbc.amazon.plugin.AwsIamAuthenticationPlugin
import ldbc.connector.*

val hostname = "aurora-instance.cluster-xxx.region.rds.amazonaws.com"
val username = "iam-user"
val config = MySQLConfig.default
  .setHost(hostname)
  .setUser(username)
  .setDatabase("mydb")
  .setSSL(SSL.Trusted)  // IAMèªè¨¼ã«ã¯SSLãŒå¿…è¦

val plugin = AwsIamAuthenticationPlugin.default[IO]("ap-northeast-1", hostname, username)

MySQLDataSource.pooling[IO](config, plugins = List(plugin)).use { datasource =>
  val connector = Connector.fromDataSource(datasource)
  // ã‚¯ã‚¨ãƒªå®Ÿè¡Œ
}
```

### 3. ldbc-hikariã®å»ƒæ­¢

`ldbc-hikari`ã¯0.5.0ã§æ­£å¼ã«å»ƒæ­¢ã•ã‚Œã¾ã—ãŸã€‚çµ„ã¿è¾¼ã¿ã®ã‚³ãƒã‚¯ã‚·ãƒ§ãƒ³ãƒ—ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚

**å»ƒæ­¢ã•ã‚ŒãŸAPI:**
```scala
// ä½¿ç”¨ä¸å¯
import ldbc.hikari.*
```

**æ¨å¥¨ã•ã‚Œã‚‹æ–¹æ³•:**
```scala
import ldbc.connector.*

val poolConfig = MySQLConfig.default
  .setHost("localhost")
  .setPort(3306)
  .setUser("user")
  .setPassword("password")
  .setDatabase("mydb")
  .setMinConnections(5)
  .setMaxConnections(20)

MySQLDataSource.pooling[IO](poolConfig).use { pool =>
  val connector = Connector.fromDataSource(pool)
  // ã‚¯ã‚¨ãƒªå®Ÿè¡Œ
}
```

### 4. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–

#### SQLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—å‡¦ç†å¼·åŒ–

æ–‡å­—åˆ—ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—å‡¦ç†ãŒæ”¹å–„ã•ã‚Œã€SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³æ”»æ’ƒã¸ã®å¯¾ç­–ãŒå¼·åŒ–ã•ã‚Œã¾ã—ãŸã€‚

#### SSRFæ”»æ’ƒå¯¾ç­–

ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹è¨­å®šæ™‚ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆæ¤œè¨¼ãŒè¿½åŠ ã•ã‚Œã¾ã—ãŸã€‚

```scala
// å®‰å…¨ã§ãªã„ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¯è‡ªå‹•çš„ã«æ¤œå‡ºãƒ»æ‹’å¦ã•ã‚Œã‚‹
val datasource = MySQLDataSource
  .build[IO]("suspicious-host", 3306, "user")
  .setPassword("password")
  .setDatabase("mydb")
```

### 5. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

#### æœ€å¤§ãƒ‘ã‚±ãƒƒãƒˆã‚µã‚¤ã‚ºã®è¨­å®š

MySQLã‚µãƒ¼ãƒãƒ¼ã®`max_allowed_packet`è¨­å®šã¨ã®äº’æ›æ€§ãŒæ”¹å–„ã•ã‚Œã¾ã—ãŸã€‚

```scala
val datasource = MySQLDataSource
  .build[IO]("localhost", 3306, "user")
  .setPassword("password")
  .setDatabase("mydb")
  .setMaxPacketSize(16777216)  // 16MBï¼ˆMySQLã‚µãƒ¼ãƒãƒ¼è¨­å®šã¨åˆã‚ã›ã‚‹ï¼‰
```

#### ã‚³ãƒã‚¯ã‚·ãƒ§ãƒ³ãƒ—ãƒ¼ãƒ«ã®åŒæ™‚æ€§æ”¹å–„

ã‚³ãƒã‚¯ã‚·ãƒ§ãƒ³ãƒ—ãƒ¼ãƒ«ã®çŠ¶æ…‹ç®¡ç†ãŒã‚¢ãƒˆãƒŸãƒƒã‚¯ãƒã‚§ãƒƒã‚¯ã«ã‚ˆã‚Šæ”¹å–„ã•ã‚Œã€ä¸¦è¡Œç’°å¢ƒã§ã®å®‰å®šæ€§ãŒå‘ä¸Šã—ã¾ã—ãŸã€‚

### 6. API ã®æ”¹å–„

#### ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ã®ã‚¯ã‚¨ãƒªå®Ÿè¡Œ

æ–°ã—ã„`updateRaws`ãƒ¡ã‚½ãƒƒãƒ‰ãŒè¿½åŠ ã•ã‚Œã€ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰SQLã‚¯ã‚¨ãƒªã‚’èª­ã¿è¾¼ã‚“ã§å®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸï¼š

```scala
import ldbc.dsl.*
import fs2.io.file.{ Files, Path }
import fs2.text

private def readFile(filename: String): IO[String] =
  Files[IO]
    .readAll(Path(filename))
    .through(text.utf8.decode)
    .compile
    .string

for
  sql <- readFile("hoge.sql")
  _ <- DBIO.updateRaws(sql).commit(connector)
yield ()
```

## ç§»è¡Œã‚¬ã‚¤ãƒ‰

### ldbc-hikariã‹ã‚‰ã®ç§»è¡Œ

**ç§»è¡Œå‰ (0.4.x):**
```scala
libraryDependencies ++= Seq(
  "io.github.takapi327" %% "ldbc-dsl" % "0.4.0",
  "io.github.takapi327" %% "ldbc-hikari" % "0.4.0"
)

import ldbc.hikari.*

val hikariConfig = Configuration.default
  .setJdbcUrl("jdbc:mysql://localhost:3306/mydb")
  .setUsername("user")
  .setPassword("password")
  .setMaximumPoolSize(20)

HikariDataSource.fromHikariConfig[IO](hikariConfig).use { pool =>
  // ä½¿ç”¨
}
```

**ç§»è¡Œå¾Œ (0.5.x):**
```scala
libraryDependencies ++= Seq(
  "io.github.takapi327" %% "ldbc-connector" % "0.5.0",
  "io.github.takapi327" %% "ldbc-dsl" % "0.5.0"
)

import ldbc.connector.*

val config = MySQLConfig.default
  .setHost("localhost")
  .setPort(3306)
  .setUser("user")
  .setPassword("password")
  .setDatabase("mydb")
  .setMaxConnections(20)

MySQLDataSource.pooling[IO](config).use { pool =>
  val connector = Connector.fromDataSource(pool)
  // ä½¿ç”¨
}
```

### ZIOçµ±åˆã®è¿½åŠ 

**Cats Effectãƒ™ãƒ¼ã‚¹ (å¾“æ¥):**
```scala
import cats.effect.*
import ldbc.connector.*

val program: IO[List[User]] = 
  datasource.getConnection.use { connection =>
    val connector = Connector.fromConnection(connection)
    sql"SELECT * FROM users".query[User].to[List].readOnly(connector)
  }
```

**ZIOãƒ™ãƒ¼ã‚¹ (æ–°è¦):**
```scala
import zio.*
import ldbc.zio.interop.*

val program: Task[List[User]] = 
  datasource.getConnection.use { connection =>
    val connector = Connector.fromConnection(connection)
    sql"SELECT * FROM users".query[User].to[List].readOnly(connector)
  }
```

## ã¾ã¨ã‚

0.5.x ã¸ã®ç§»è¡Œã«ã‚ˆã‚Šã€ä»¥ä¸‹ã®ãƒ¡ãƒªãƒƒãƒˆãŒå¾—ã‚‰ã‚Œã¾ã™ï¼š

1. **ZIOã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ ã®å®Œå…¨ã‚µãƒãƒ¼ãƒˆ**: ZIOãƒ™ãƒ¼ã‚¹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã®è‡ªç„¶ãªçµ±åˆ
2. **å¼·åŒ–ã•ã‚ŒãŸã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**: SSRFæ”»æ’ƒå¯¾ç­–ã€SQLã‚¨ã‚¹ã‚±ãƒ¼ãƒ—å‡¦ç†ã®æ”¹å–„
3. **AWSçµ±åˆã®ç°¡ç´ åŒ–**: Aurora IAMèªè¨¼ã®ç°¡å˜ãªè¨­å®š
4. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®å‘ä¸Š**: æœ€å¤§ãƒ‘ã‚±ãƒƒãƒˆã‚µã‚¤ã‚ºå¯¾å¿œã€ãƒ—ãƒ¼ãƒ«ä¸¦è¡Œæ€§æ”¹å–„
5. **é–‹ç™ºè€…ä½“é¨“ã®å‘ä¸Š**: æ–°ã—ã„APIã€ãƒã‚¤ãƒŠãƒªäº’æ›æ€§ãƒã‚§ãƒƒã‚¯

ç§»è¡Œä½œæ¥­ã¯ä¸»ã«ãƒ©ã‚¤ãƒ–ãƒ©ãƒªä¾å­˜é–¢ä¿‚ã®æ›´æ–°ã¨APIã®å°ã•ãªå¤‰æ›´ã§å®Œäº†ã—ã€æ®µéšçš„ãªç§»è¡ŒãŒå¯èƒ½ã§ã™ã€‚
